<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/spark/SparkRestClient.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>utils/spark/SparkRestClient.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L19">SparkRestClient</a></li>
<li><a href="#L126">SparkRestClient</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L114">get</a></li>
<li><a href="#L72">getApplicationEnvironmentInfo</a></li>
<li><a href="#L60">getApplicationInfo</a></li>
<li><a href="#L40">getApplicationInfos</a></li>
<li><a href="#L84">getJobDatas</a></li>
<li><a href="#L109">getStageAttemptDatas</a></li>
<li><a href="#L96">getStagesWithSummaries</a></li>
</ul>
 <h2>Source code</h2>

  <code>package com.microsoft.spark.insight.utils.spark<br/>
<br/>
import java.net.URI<br/>
import java.util.Date<br/>
<br/>
import javax.ws.rs.client.{ClientBuilder, WebTarget}<br/>
import javax.ws.rs.core.MediaType<br/>
import org.apache.spark.<a href="../../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a>.api.v1._<br/>
import org.glassfish.jersey.client.ClientProperties<br/>
import org.slf4j.{Logger, LoggerFactory}<br/>
<br/>
import scala.util.control.NonFatal<br/>
<br/>
/**<br/>
 * A REST client used to fetch Application data from a Spark History Server<br/>
 *<br/>
 * @param historyServerUri <a href="../../fetcher/status/statusapiv1.scala.html#L136" title="fetcher/status/statusapiv1.scala:136">address</a> of the history server to be used<br/>
 */<br/>
<a id="L19">&#x200c;</a>class <span class="linkable">SparkRestClient</span>(historyServerUri: URI) {<br/>
&nbsp; val LOGGER: Logger = LoggerFactory.getLogger(classOf[<a href="../../fetcher/SparkRestClient.scala.html#L48" title="fetcher/SparkRestClient.scala:48">SparkRestClient</a>])<br/>
&nbsp; import <a href="../../fetcher/SparkRestClient.scala.html#L48" title="fetcher/SparkRestClient.scala:48">SparkRestClient</a>._<br/>
<br/>
&nbsp; private val client = ClientBuilder.newClient()<br/>
<br/>
&nbsp; private val apiTarget: WebTarget = client<br/>
&nbsp; &nbsp; .property(ClientProperties.CONNECT_TIMEOUT, CONNECTION_TIMEOUT)<br/>
&nbsp; &nbsp; .property(ClientProperties.READ_TIMEOUT, READ_TIMEOUT)<br/>
&nbsp; &nbsp; .target(historyServerUri)<br/>
&nbsp; &nbsp; .path(API_V1_MOUNT_PATH)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Fetch [[<a href="../../fetcher/status/statusapiv1.scala.html#L46" title="fetcher/status/statusapiv1.scala:46">ApplicationInfo</a>]]s within the specified date range and that match the specified <a href="../../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a><br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param maxApps limit the number of fetched apps<br/>
&nbsp;&nbsp; * @param minStartDate earliest start date to fetch<br/>
&nbsp;&nbsp; * @param maxStartDate latest start date to fetch<br/>
&nbsp;&nbsp; * @param <a href="../../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a> only fetch applications with this <a href="../../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a><br/>
&nbsp;&nbsp; * @return ApplicationInfos<br/>
&nbsp;&nbsp; */<br/>
<a id="L40">&#x200c;</a>&nbsp; def <span class="linkable">getApplicationInfos</span>(<br/>
&nbsp; &nbsp; &nbsp; maxApps: Integer,<br/>
&nbsp; &nbsp; &nbsp; minStartDate: Date,<br/>
&nbsp; &nbsp; &nbsp; maxStartDate: Date,<br/>
&nbsp; &nbsp; &nbsp; <a href="../../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a>: ApplicationStatus): Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L46" title="fetcher/status/statusapiv1.scala:46">ApplicationInfo</a>] = {<br/>
&nbsp; &nbsp; val appTarget = apiTarget<br/>
&nbsp; &nbsp; &nbsp; .path(s&quot;applications&quot;)<br/>
&nbsp; &nbsp; &nbsp; .queryParam(&quot;limit&quot;, maxApps)<br/>
&nbsp; &nbsp; &nbsp; .queryParam(&quot;minDate&quot;, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.DATE_FORMAT.<a href="../../heuristics/StageAnalyzer.scala.html#L39" title="heuristics/StageAnalyzer.scala:39">format</a>(minStartDate))<br/>
&nbsp; &nbsp; &nbsp; .queryParam(&quot;maxDate&quot;, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.DATE_FORMAT.<a href="../../heuristics/StageAnalyzer.scala.html#L39" title="heuristics/StageAnalyzer.scala:39">format</a>(maxStartDate))<br/>
&nbsp; &nbsp; &nbsp; .queryParam(&quot;<a href="../../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a>&quot;, <a href="../../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a>)<br/>
&nbsp; &nbsp; <a href="../../fetcher/SparkRestClient.scala.html#L229" title="fetcher/SparkRestClient.scala:229">get</a>(appTarget, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.<a href="SparkJsonUtils.scala.html#L24" title="utils/spark/SparkJsonUtils.scala:24">fromJson</a>[Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L46" title="fetcher/status/statusapiv1.scala:46">ApplicationInfo</a>]])<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Fetch a single [[<a href="../../fetcher/status/statusapiv1.scala.html#L46" title="fetcher/status/statusapiv1.scala:46">ApplicationInfo</a>]] for the specified <a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a><br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param <a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a> ApplicationId to fetch<br/>
&nbsp;&nbsp; * @return <a href="../../fetcher/status/statusapiv1.scala.html#L46" title="fetcher/status/statusapiv1.scala:46">ApplicationInfo</a><br/>
&nbsp;&nbsp; */<br/>
<a id="L60">&#x200c;</a>&nbsp; def <span class="linkable">getApplicationInfo</span>(<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>: String): <a href="../../fetcher/status/statusapiv1.scala.html#L46" title="fetcher/status/statusapiv1.scala:46">ApplicationInfo</a> = {<br/>
&nbsp; &nbsp; val appTarget = apiTarget.path(s&quot;applications/${<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>}&quot;)<br/>
&nbsp; &nbsp; <a href="../../fetcher/SparkRestClient.scala.html#L229" title="fetcher/SparkRestClient.scala:229">get</a>(appTarget, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.<a href="SparkJsonUtils.scala.html#L24" title="utils/spark/SparkJsonUtils.scala:24">fromJson</a>[<a href="../../fetcher/status/statusapiv1.scala.html#L46" title="fetcher/status/statusapiv1.scala:46">ApplicationInfo</a>])<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Fetch [[<a href="../../fetcher/status/statusapiv1.scala.html#L52" title="fetcher/status/statusapiv1.scala:52">ApplicationEnvironmentInfo</a>]] for the specified applicationId and applicationAttemptId<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param <a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a> applicationId to fetch<br/>
&nbsp;&nbsp; * @param appAttemptId application AttemptId to fetch<br/>
&nbsp;&nbsp; * @return <a href="../../fetcher/status/statusapiv1.scala.html#L52" title="fetcher/status/statusapiv1.scala:52">ApplicationEnvironmentInfo</a><br/>
&nbsp;&nbsp; */<br/>
<a id="L72">&#x200c;</a>&nbsp; def <span class="linkable">getApplicationEnvironmentInfo</span>(<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>: String, appAttemptId: String): <a href="../../fetcher/status/statusapiv1.scala.html#L52" title="fetcher/status/statusapiv1.scala:52">ApplicationEnvironmentInfo</a> = {<br/>
&nbsp; &nbsp; val appEnvTarget = apiTarget.path(s&quot;applications/${<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>}/${appAttemptId}/environment&quot;)<br/>
&nbsp; &nbsp; <a href="../../fetcher/SparkRestClient.scala.html#L229" title="fetcher/SparkRestClient.scala:229">get</a>(appEnvTarget, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.<a href="SparkJsonUtils.scala.html#L24" title="utils/spark/SparkJsonUtils.scala:24">fromJson</a>[<a href="../../fetcher/status/statusapiv1.scala.html#L52" title="fetcher/status/statusapiv1.scala:52">ApplicationEnvironmentInfo</a>])<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Fetch Job information for the specified applicationId and applicationAttemptId<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param <a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a> applicationId to fetch<br/>
&nbsp;&nbsp; * @param appAttemptId application AttemptId to fetch<br/>
&nbsp;&nbsp; * @return JobDatas<br/>
&nbsp;&nbsp; */<br/>
<a id="L84">&#x200c;</a>&nbsp; def <span class="linkable">getJobDatas</span>(<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>: String, appAttemptId: String): Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L103" title="fetcher/status/statusapiv1.scala:103">JobData</a>] = {<br/>
&nbsp; &nbsp; val jobsTarget = apiTarget.path(s&quot;applications/${<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>}/${appAttemptId}/jobs&quot;)<br/>
&nbsp; &nbsp; <a href="../../fetcher/SparkRestClient.scala.html#L229" title="fetcher/SparkRestClient.scala:229">get</a>(jobsTarget, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.<a href="SparkJsonUtils.scala.html#L24" title="utils/spark/SparkJsonUtils.scala:24">fromJson</a>[Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L103" title="fetcher/status/statusapiv1.scala:103">JobData</a>]])<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Fetch all of the Stages information for the specified applicationId and applicationAttemptId<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param <a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a> applicationId to fetch<br/>
&nbsp;&nbsp; * @param appAttemptId application AttemptId to fetch<br/>
&nbsp;&nbsp; * @return StageDatas<br/>
&nbsp;&nbsp; */<br/>
<a id="L96">&#x200c;</a>&nbsp; def <span class="linkable">getStagesWithSummaries</span>(<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>: String, appAttemptId: String): Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L148" title="fetcher/status/statusapiv1.scala:148">StageData</a>] = {<br/>
&nbsp; &nbsp; val stageTarget = apiTarget.path(s&quot;applications/${<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>}/${appAttemptId}/stages/withSummaries&quot;)<br/>
&nbsp; &nbsp; <a href="../../fetcher/SparkRestClient.scala.html#L229" title="fetcher/SparkRestClient.scala:229">get</a>(stageTarget, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.<a href="SparkJsonUtils.scala.html#L24" title="utils/spark/SparkJsonUtils.scala:24">fromJson</a>[Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L148" title="fetcher/status/statusapiv1.scala:148">StageData</a>]])<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Fetch Stage information for the specified applicationId and applicationAttemptId<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param <a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a> applicationId to fetch<br/>
&nbsp;&nbsp; * @param appAttemptId application AttemptId to fetch<br/>
&nbsp;&nbsp; * @param <a href="../../fetcher/status/statusapiv1.scala.html#L150" title="fetcher/status/statusapiv1.scala:150">stageId</a> <a href="../../fetcher/status/statusapiv1.scala.html#L150" title="fetcher/status/statusapiv1.scala:150">stageId</a> to fetch<br/>
&nbsp;&nbsp; * @return StageDatas<br/>
&nbsp;&nbsp; */<br/>
<a id="L109">&#x200c;</a>&nbsp; def <span class="linkable">getStageAttemptDatas</span>(<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>: String, appAttemptId: String, <a href="../../fetcher/status/statusapiv1.scala.html#L150" title="fetcher/status/statusapiv1.scala:150">stageId</a>: String): Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L148" title="fetcher/status/statusapiv1.scala:148">StageData</a>] = {<br/>
&nbsp; &nbsp; val stageTarget = apiTarget.path(s&quot;applications/${<a href="RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>}/${appAttemptId}/stages/${<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="fetcher/status/statusapiv1.scala:150">stageId</a>}&quot;)<br/>
&nbsp; &nbsp; <a href="../../fetcher/SparkRestClient.scala.html#L229" title="fetcher/SparkRestClient.scala:229">get</a>(stageTarget, <a href="SparkJsonUtils.scala.html#L14" title="utils/spark/SparkJsonUtils.scala:14">SparkJsonUtils</a>.<a href="SparkJsonUtils.scala.html#L24" title="utils/spark/SparkJsonUtils.scala:24">fromJson</a>[Seq[<a href="../../fetcher/status/statusapiv1.scala.html#L148" title="fetcher/status/statusapiv1.scala:148">StageData</a>]])<br/>
&nbsp; }<br/>
<br/>
<a id="L114">&#x200c;</a>&nbsp; protected def <span class="linkable">get</span>[T](webTarget: WebTarget, converter: String =&gt; T): T = {<br/>
&nbsp; &nbsp; LOGGER.info(&quot;calling REST API at {}&quot;, webTarget.getUri)<br/>
&nbsp; &nbsp; try {<br/>
&nbsp; &nbsp; &nbsp; converter(webTarget.request(MediaType.APPLICATION_JSON).<a href="../../fetcher/SparkRestClient.scala.html#L229" title="fetcher/SparkRestClient.scala:229">get</a>(classOf[String]))<br/>
&nbsp; &nbsp; } catch {<br/>
&nbsp; &nbsp; &nbsp; case NonFatal(e) =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; LOGGER.error(&quot;Error reading from URI: {}. Exception Message = {}&quot;, webTarget.getUri, e.<a href="../../heuristics/StageAnalyzer.scala.html#L519" title="heuristics/StageAnalyzer.scala:519">getMessage</a>, e)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; throw e<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
}<br/>
<br/>
<a id="L126">&#x200c;</a>object <span class="linkable">SparkRestClient</span> {<br/>
&nbsp; val API_V1_MOUNT_PATH = &quot;api/v1&quot;<br/>
&nbsp; val CONNECTION_TIMEOUT = 5000<br/>
&nbsp; val READ_TIMEOUT = 240000<br/>
}<br/>
</code>

 </body>
</html>
