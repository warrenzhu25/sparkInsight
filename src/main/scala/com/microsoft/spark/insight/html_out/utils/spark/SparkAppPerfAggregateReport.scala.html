<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/spark/SparkAppPerfAggregateReport.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>utils/spark/SparkAppPerfAggregateReport.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L17">SparkAppPerfAggregateReport</a></li>
<li><a href="#L36">SparkAppPerfAggregateReport</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L38">AggregatePerfMetrics</a></li>
<li><a href="#L58">accumulatedPerfMetrics</a></li>
<li><a href="#L54">jobLevelAggregatePerfMetrics</a></li>
<li><a href="#L51">perJobAggregatePerfMetrics</a></li>
<li><a href="#L48">perStageAggregatePerfMetrics</a></li>
</ul>
 <h2>Source code</h2>

  <code>package com.microsoft.spark.insight.utils.spark<br/>
<br/>
import com.microsoft.spark.insight.utils._<br/>
import com.microsoft.spark.insight.utils.spark.<a href="#L17" title="utils/spark/SparkAppPerfAggregateReport.scala:17">SparkAppPerfAggregateReport</a>._<br/>
import com.microsoft.spark.insight.utils.spark.<a href="SparkAppReportMatcher.scala.html#L17" title="utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>._<br/>
import com.microsoft.spark.insight.utils.{<a href="../AggregatePerfValue.scala.html#L6" title="utils/AggregatePerfValue.scala:6">AggregatePerfValue</a>, <a href="../AggregatePerfValueImpl.scala.html#L10" title="utils/AggregatePerfValueImpl.scala:10">AggregatePerfValueImpl</a>}<br/>
<br/>
import scala.collection.immutable.ListMap<br/>
<br/>
/**<br/>
 * Construct an aggregated report for the given set of [[<a href="SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s. The report will try to match all of<br/>
 * the given app reports, and if they match, will produce an [[<a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>]] per every given matching <a href="../../fetcher/status/statusapiv1.scala.html#L109" title="fetcher/status/statusapiv1.scala:109">stageIds</a>.<br/>
 * The report will also produce an [[<a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>]] for the summaries of each app report<br/>
 *<br/>
 * @param appPerfReports set of [[<a href="SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s to aggregate<br/>
 */<br/>
<a id="L17">&#x200c;</a>class <span class="linkable">SparkAppPerfAggregateReport</span>(val appPerfReports: Seq[<a href="SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>])<br/>
&nbsp; &nbsp; extends <a href="SparkAppPerfReportBase.scala.html#L19" title="utils/spark/SparkAppPerfReportBase.scala:19">SparkAppPerfReportBase</a>[JobName, StageName, <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>] {<br/>
<br/>
&nbsp; override protected def <a href="SparkAppPerfReportBase.scala.html#L33" title="utils/spark/SparkAppPerfReportBase.scala:33">buildPerJobData</a>: () =&gt; Seq[(JobName, Seq[(StageName, <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>)])] =<br/>
&nbsp; &nbsp; () =&gt; new <a href="SparkAppReportMatcher.scala.html#L17" title="utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>(appPerfReports).<a href="SparkAppReportMatcher.scala.html#L28" title="utils/spark/SparkAppReportMatcher.scala:28">matchingAppReports</a>.map(<a href="#L51" title="utils/spark/SparkAppPerfAggregateReport.scala:51">perJobAggregatePerfMetrics</a>)<br/>
<br/>
&nbsp; override protected def <a href="SparkAppPerfReportBase.scala.html#L40" title="utils/spark/SparkAppPerfReportBase.scala:40">buildSummaryReport</a>: () =&gt; <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a> =<br/>
&nbsp; &nbsp; () =&gt; <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>(appPerfReports.map(_.<a href="SparkAppPerfReportBase.scala.html#L63" title="utils/spark/SparkAppPerfReportBase.scala:63">summaryReport</a>))<br/>
<br/>
&nbsp; override protected def <a href="SparkAppPerfReportBase.scala.html#L48" title="utils/spark/SparkAppPerfReportBase.scala:48">buildJobLevelReport</a>: () =&gt; ListMap[JobName, <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>] =<br/>
&nbsp; &nbsp; () =&gt; {<br/>
&nbsp; &nbsp; &nbsp; var jobLevelData = ListMap[JobName, <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>]()<br/>
&nbsp; &nbsp; &nbsp; if (<a href="SparkAppPerfReportBase.scala.html#L56" title="utils/spark/SparkAppPerfReportBase.scala:56">perJobReport</a>.<a href="PerJobReport.scala.html#L40" title="utils/spark/PerJobReport.scala:40">isValid</a>)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; new <a href="SparkAppReportMatcher.scala.html#L17" title="utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>(appPerfReports).<a href="SparkAppReportMatcher.scala.html#L28" title="utils/spark/SparkAppReportMatcher.scala:28">matchingAppReports</a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .foreach(jobLevelData += <a href="#L54" title="utils/spark/SparkAppPerfAggregateReport.scala:54">jobLevelAggregatePerfMetrics</a>(_))<br/>
&nbsp; &nbsp; &nbsp; jobLevelData<br/>
&nbsp; &nbsp; }<br/>
}<br/>
<br/>
<a id="L36">&#x200c;</a>object <span class="linkable">SparkAppPerfAggregateReport</span> {<br/>
&nbsp; type <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a> = <a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[<a href="../AggregatePerfValue.scala.html#L6" title="utils/AggregatePerfValue.scala:6">AggregatePerfValue</a>]<br/>
<a id="L38">&#x200c;</a>&nbsp; private def <span class="linkable">AggregatePerfMetrics</span>(perfMetricsSeq: Seq[<a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[PerfValue]]): <span class="linkable">AggregatePerfMetrics</span> = {<br/>
&nbsp; &nbsp; val perfMetricsToAggregate = perfMetricsSeq.flatMap(_.keys).distinct<br/>
&nbsp; &nbsp; perfMetricsToAggregate<br/>
&nbsp; &nbsp; &nbsp; .map(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; perfMetric =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; perfMetric -&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new <a href="../AggregatePerfValueImpl.scala.html#L10" title="utils/AggregatePerfValueImpl.scala:10">AggregatePerfValueImpl</a>(perfMetricsSeq.map(_(perfMetric))))<br/>
&nbsp; &nbsp; &nbsp; .toMap<br/>
&nbsp; }<br/>
<br/>
<a id="L48">&#x200c;</a>&nbsp; private def <span class="linkable">perStageAggregatePerfMetrics</span>(matchingStageMetrics: <a href="SparkAppReportMatcher.scala.html#L53" title="utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>) =<br/>
&nbsp; &nbsp; matchingStageMetrics.stageName -&gt; <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>(matchingStageMetrics.stageMetricsSeq.map(_.perfMetrics))<br/>
<br/>
<a id="L51">&#x200c;</a>&nbsp; private def <span class="linkable">perJobAggregatePerfMetrics</span>(matchingJobMetrics: <a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>) =<br/>
&nbsp; &nbsp; matchingJobMetrics.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="html/SparkAppHtmlUtils.scala:348">jobName</a> -&gt; matchingJobMetrics.matchingStageMetricsSeq.map(<a href="#L48" title="utils/spark/SparkAppPerfAggregateReport.scala:48">perStageAggregatePerfMetrics</a>)<br/>
<br/>
<a id="L54">&#x200c;</a>&nbsp; private def <span class="linkable">jobLevelAggregatePerfMetrics</span>(matchingJobMetrics: <a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>) = {<br/>
&nbsp; &nbsp; matchingJobMetrics.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="html/SparkAppHtmlUtils.scala:348">jobName</a> -&gt; <a href="#L38" title="utils/spark/SparkAppPerfAggregateReport.scala:38">AggregatePerfMetrics</a>(<a href="#L58" title="utils/spark/SparkAppPerfAggregateReport.scala:58">accumulatedPerfMetrics</a>(matchingJobMetrics))<br/>
&nbsp; }<br/>
<br/>
<a id="L58">&#x200c;</a>&nbsp; private[utils] def <span class="linkable">accumulatedPerfMetrics</span>(matchingJobMetrics: <a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>) = {<br/>
&nbsp; &nbsp; for (i &lt;- matchingJobMetrics.matchingStageMetricsSeq.head.stageMetricsSeq.indices)<br/>
&nbsp; &nbsp; &nbsp; yield<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>.<a href="SparkAppPerfReport.scala.html#L188" title="utils/spark/SparkAppPerfReport.scala:188">accumulatedMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; matchingJobMetrics.matchingStageMetricsSeq.map(_.stageMetricsSeq(i).perfMetrics))<br/>
&nbsp; }<br/>
}<br/>
</code>

 </body>
</html>
