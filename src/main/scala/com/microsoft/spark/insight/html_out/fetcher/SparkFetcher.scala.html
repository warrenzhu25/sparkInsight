<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>fetcher/SparkFetcher.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>fetcher/SparkFetcher.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L18">SparkFetcher</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L40">doFetchData</a></li>
<li><a href="#L59">doFetchDataUsingRestClients</a></li>
<li><a href="#L55">doFetchSparkApplicationData</a></li>
</ul>
 <h2>Source code</h2>

  <code><br/>
package com.microsoft.spark.insight.fetcher<br/>
<br/>
import java.util.concurrent.TimeoutException<br/>
<br/>
import org.apache.hadoop.conf.Configuration<br/>
import org.apache.log4j.Logger<br/>
<br/>
import scala.concurrent.duration.{Duration, HOURS, SECONDS}<br/>
import scala.concurrent.{Await, ExecutionContext, Future}<br/>
import scala.io.Source<br/>
import scala.util.{Failure, Success, Try}<br/>
<br/>
<br/>
/**<br/>
&nbsp; * A fetcher that gets Spark-related data from a combination of the Spark monitoring REST API and Spark event logs.<br/>
&nbsp; */<br/>
<a id="L18">&#x200c;</a>object <span class="linkable">SparkFetcher</span> extends <a href="Fetcher.scala.html#L3" title="fetcher/Fetcher.scala:3">Fetcher</a> {<br/>
<br/>
&nbsp; import ExecutionContext.Implicits.global<br/>
<br/>
&nbsp; private val logger: Logger = Logger.getLogger(<a href="#L18" title="fetcher/SparkFetcher.scala:18">SparkFetcher</a>.getClass)<br/>
<br/>
&nbsp; private val DEFAULT_TIMEOUT = Duration(1, HOURS)<br/>
<br/>
&nbsp; private[fetcher] lazy val hadoopConfiguration: Configuration = new Configuration()<br/>
<br/>
&nbsp; private[fetcher] lazy val sparkRestClient: <a href="SparkRestClient.scala.html#L48" title="fetcher/SparkRestClient.scala:48">SparkRestClient</a> = new <a href="SparkRestClient.scala.html#L48" title="fetcher/SparkRestClient.scala:48">SparkRestClient</a>()<br/>
<br/>
&nbsp; override def <a href="Fetcher.scala.html#L4" title="fetcher/Fetcher.scala:4">fetchData</a>(trackingUrl: String): <a href="SparkApplicationData.scala.html#L21" title="fetcher/SparkApplicationData.scala:21">SparkApplicationData</a> = {<br/>
&nbsp; &nbsp; <a href="#L40" title="fetcher/SparkFetcher.scala:40">doFetchData</a>(trackingUrl) match {<br/>
&nbsp; &nbsp; &nbsp; case Success(data) =&gt; data<br/>
&nbsp; &nbsp; &nbsp; case Failure(e) =&gt; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; logger.error(e)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; throw e<br/>
&nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
<a id="L40">&#x200c;</a>&nbsp; private def <span class="linkable">doFetchData</span>(trackingUrl: String): Try[<a href="SparkApplicationData.scala.html#L21" title="fetcher/SparkApplicationData.scala:21">SparkApplicationData</a>] = {<br/>
&nbsp; &nbsp; Try {<br/>
&nbsp; &nbsp; &nbsp; Await.result(<a href="#L55" title="fetcher/SparkFetcher.scala:55">doFetchSparkApplicationData</a>(trackingUrl), DEFAULT_TIMEOUT)<br/>
&nbsp; &nbsp; }.transform(<br/>
&nbsp; &nbsp; &nbsp; data =&gt; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; logger.info(s&quot;Succeeded fetching data for ${trackingUrl}&quot;)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Success(data)<br/>
&nbsp; &nbsp; &nbsp; },<br/>
&nbsp; &nbsp; &nbsp; e =&gt; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; logger.warn(s&quot;Failed fetching data for ${trackingUrl}.&quot; + &quot; I will retry after some time! &quot; + &quot;Exception Message is: &quot; + e.<a href="../heuristics/StageAnalyzer.scala.html#L519" title="heuristics/StageAnalyzer.scala:519">getMessage</a>)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Failure(e)<br/>
&nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; )<br/>
&nbsp; }<br/>
<br/>
<a id="L55">&#x200c;</a>&nbsp; private def <span class="linkable">doFetchSparkApplicationData</span>(trackingUrl: String): Future[<a href="SparkApplicationData.scala.html#L21" title="fetcher/SparkApplicationData.scala:21">SparkApplicationData</a>] = {<br/>
&nbsp; &nbsp; <a href="#L59" title="fetcher/SparkFetcher.scala:59">doFetchDataUsingRestClients</a>(trackingUrl)<br/>
&nbsp; }<br/>
<br/>
<a id="L59">&#x200c;</a>&nbsp; private def <span class="linkable">doFetchDataUsingRestClients</span>(trackingUrl: String): Future[<a href="SparkApplicationData.scala.html#L21" title="fetcher/SparkApplicationData.scala:21">SparkApplicationData</a>] = Future {<br/>
&nbsp; &nbsp; Await.result(sparkRestClient.<a href="Fetcher.scala.html#L4" title="fetcher/Fetcher.scala:4">fetchData</a>(trackingUrl), DEFAULT_TIMEOUT)<br/>
&nbsp; }<br/>
}<br/>
</code>

 </body>
</html>
