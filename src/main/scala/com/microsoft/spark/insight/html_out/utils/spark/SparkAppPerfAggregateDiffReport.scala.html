<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/spark/SparkAppPerfAggregateDiffReport.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>utils/spark/SparkAppPerfAggregateDiffReport.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L48">AggregateDiffPerfValue</a></li>
<li><a href="#L23">SparkAppPerfAggregateDiffReport</a></li>
<li><a href="#L47">SparkAppPerfAggregateDiffReport</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L51">AggregateDiffPerfMetrics</a></li>
<li><a href="#L77">jobLevelAggregateDiffMetrics</a></li>
<li><a href="#L72">perJobAggregateDiffMetrics</a></li>
<li><a href="#L66">perStageAggregateDiffMetrics</a></li>
</ul>
 <h2>Source code</h2>

  <code>package com.microsoft.spark.insight.utils.spark<br/>
<br/>
import com.microsoft.spark.insight.utils._<br/>
import com.microsoft.spark.insight.utils.spark.<a href="#L23" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:23">SparkAppPerfAggregateDiffReport</a>._<br/>
import com.microsoft.spark.insight.utils.spark.<a href="SparkAppReportMatcher.scala.html#L17" title="utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>.{<br/>
&nbsp; JobName,<br/>
&nbsp; <a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>,<br/>
&nbsp; <a href="SparkAppReportMatcher.scala.html#L53" title="utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>,<br/>
&nbsp; StageName<br/>
}<br/>
import com.microsoft.spark.insight.utils.{<a href="../AggregatePerfValue.scala.html#L6" title="utils/AggregatePerfValue.scala:6">AggregatePerfValue</a>, <a href="../AggregatePerfValueImpl.scala.html#L10" title="utils/AggregatePerfValueImpl.scala:10">AggregatePerfValueImpl</a>}<br/>
<br/>
import scala.collection.immutable.ListMap<br/>
<br/>
/**<br/>
 * A side-by-side comparison report between two sets of [[<a href="SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s. The report will try to match all of<br/>
 * the given app reports, and if they match, will produce an [[<a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>]] per every given matching<br/>
 * <a href="../../fetcher/status/statusapiv1.scala.html#L109" title="fetcher/status/statusapiv1.scala:109">stageIds</a>. The report will also produce an [[<a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>]] for the summaries of each app report<br/>
 *<br/>
 * @param appPerfReports1 application report set #1<br/>
 * @param appPerfReports2 application report set #2<br/>
 */<br/>
<a id="L23">&#x200c;</a>class <span class="linkable">SparkAppPerfAggregateDiffReport</span>(<br/>
&nbsp; &nbsp; appPerfReports1: Seq[<a href="SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>],<br/>
&nbsp; &nbsp; appPerfReports2: Seq[<a href="SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>])<br/>
&nbsp; &nbsp; extends <a href="SparkAppPerfReportBase.scala.html#L19" title="utils/spark/SparkAppPerfReportBase.scala:19">SparkAppPerfReportBase</a>[JobName, StageName, <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>] {<br/>
<br/>
&nbsp; override protected def <a href="SparkAppPerfReportBase.scala.html#L33" title="utils/spark/SparkAppPerfReportBase.scala:33">buildPerJobData</a>: () =&gt; Seq[(JobName, Seq[(StageName, <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>)])] = () =&gt; {<br/>
&nbsp; &nbsp; val (appMatcher1, appMatcher2) = <a href="SparkAppReportMatcher.scala.html#L17" title="utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>.<a href="SparkAppReportMatcher.scala.html#L299" title="utils/spark/SparkAppReportMatcher.scala:299">matchAppReportSets</a>(appPerfReports1, appPerfReports2)<br/>
&nbsp; &nbsp; (appMatcher1.<a href="SparkAppReportMatcher.scala.html#L28" title="utils/spark/SparkAppReportMatcher.scala:28">matchingAppReports</a> zip appMatcher2.<a href="SparkAppReportMatcher.scala.html#L28" title="utils/spark/SparkAppReportMatcher.scala:28">matchingAppReports</a>).map(<a href="#L72" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:72">perJobAggregateDiffMetrics</a>)<br/>
&nbsp; }<br/>
<br/>
&nbsp; override protected def <a href="SparkAppPerfReportBase.scala.html#L40" title="utils/spark/SparkAppPerfReportBase.scala:40">buildSummaryReport</a>: () =&gt; <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a> =<br/>
&nbsp; &nbsp; () =&gt; <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>(appPerfReports1.map(_.<a href="SparkAppPerfReportBase.scala.html#L63" title="utils/spark/SparkAppPerfReportBase.scala:63">summaryReport</a>), appPerfReports2.map(_.<a href="SparkAppPerfReportBase.scala.html#L63" title="utils/spark/SparkAppPerfReportBase.scala:63">summaryReport</a>))<br/>
<br/>
&nbsp; override protected def <a href="SparkAppPerfReportBase.scala.html#L48" title="utils/spark/SparkAppPerfReportBase.scala:48">buildJobLevelReport</a>: () =&gt; ListMap[JobName, <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>] = () =&gt; {<br/>
&nbsp; &nbsp; var jobLevelData = ListMap[JobName, <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>]()<br/>
&nbsp; &nbsp; if (<a href="SparkAppPerfReportBase.scala.html#L56" title="utils/spark/SparkAppPerfReportBase.scala:56">perJobReport</a>.<a href="PerJobReport.scala.html#L40" title="utils/spark/PerJobReport.scala:40">isValid</a>) {<br/>
&nbsp; &nbsp; &nbsp; val (appMatcher1, appMatcher2) = <a href="SparkAppReportMatcher.scala.html#L17" title="utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>.<a href="SparkAppReportMatcher.scala.html#L299" title="utils/spark/SparkAppReportMatcher.scala:299">matchAppReportSets</a>(appPerfReports1, appPerfReports2)<br/>
&nbsp; &nbsp; &nbsp; (appMatcher1.<a href="SparkAppReportMatcher.scala.html#L28" title="utils/spark/SparkAppReportMatcher.scala:28">matchingAppReports</a> zip appMatcher2.<a href="SparkAppReportMatcher.scala.html#L28" title="utils/spark/SparkAppReportMatcher.scala:28">matchingAppReports</a>)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; .foreach(jobLevelData += <a href="#L77" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:77">jobLevelAggregateDiffMetrics</a>(_))<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; jobLevelData<br/>
&nbsp; }<br/>
}<br/>
<br/>
<a id="L47">&#x200c;</a>object <span class="linkable">SparkAppPerfAggregateDiffReport</span> {<br/>
<a id="L48">&#x200c;</a>&nbsp; case class <span class="linkable">AggregateDiffPerfValue</span>(aggregatePerfValue1: <a href="../AggregatePerfValue.scala.html#L6" title="utils/AggregatePerfValue.scala:6">AggregatePerfValue</a>, aggregatePerfValue2: <a href="../AggregatePerfValue.scala.html#L6" title="utils/AggregatePerfValue.scala:6">AggregatePerfValue</a>)<br/>
<br/>
&nbsp; type <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a> = <a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[<a href="#L48" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:48">AggregateDiffPerfValue</a>]<br/>
<a id="L51">&#x200c;</a>&nbsp; private def <span class="linkable">AggregateDiffPerfMetrics</span>(<br/>
&nbsp; &nbsp; &nbsp; perfMetricsSeq1: Seq[<a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[PerfValue]],<br/>
&nbsp; &nbsp; &nbsp; perfMetricsSeq2: Seq[<a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[PerfValue]]): <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a> = {<br/>
&nbsp; &nbsp; val perfMetricsToAggregate = perfMetricsSeq1.flatMap(_.keys).distinct<br/>
<br/>
&nbsp; &nbsp; perfMetricsToAggregate<br/>
&nbsp; &nbsp; &nbsp; .map(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; perfMetric =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; perfMetric -&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L48" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:48">AggregateDiffPerfValue</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new <a href="../AggregatePerfValueImpl.scala.html#L10" title="utils/AggregatePerfValueImpl.scala:10">AggregatePerfValueImpl</a>(perfMetricsSeq1.map(_(perfMetric))),<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; new <a href="../AggregatePerfValueImpl.scala.html#L10" title="utils/AggregatePerfValueImpl.scala:10">AggregatePerfValueImpl</a>(perfMetricsSeq2.map(_(perfMetric)))))<br/>
&nbsp; &nbsp; &nbsp; .toMap<br/>
&nbsp; }<br/>
<br/>
<a id="L66">&#x200c;</a>&nbsp; private def <span class="linkable">perStageAggregateDiffMetrics</span>(matchingStageMetricsPair: (<a href="SparkAppReportMatcher.scala.html#L53" title="utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>, <a href="SparkAppReportMatcher.scala.html#L53" title="utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>)) =<br/>
&nbsp; &nbsp; matchingStageMetricsPair._1.stageName -&gt;<br/>
&nbsp; &nbsp; &nbsp; <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; matchingStageMetricsPair._1.stageMetricsSeq.map(_.perfMetrics),<br/>
&nbsp; &nbsp; &nbsp; &nbsp; matchingStageMetricsPair._2.stageMetricsSeq.map(_.perfMetrics))<br/>
<br/>
<a id="L72">&#x200c;</a>&nbsp; private def <span class="linkable">perJobAggregateDiffMetrics</span>(matchingJobMetricsPair: (<a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>, <a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>)) =<br/>
&nbsp; &nbsp; matchingJobMetricsPair._1.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="html/SparkAppHtmlUtils.scala:348">jobName</a> -&gt;<br/>
&nbsp; &nbsp; &nbsp; (matchingJobMetricsPair._1.matchingStageMetricsSeq zip matchingJobMetricsPair._2.matchingStageMetricsSeq)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; .map(<a href="#L66" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:66">perStageAggregateDiffMetrics</a>)<br/>
<br/>
<a id="L77">&#x200c;</a>&nbsp; private def <span class="linkable">jobLevelAggregateDiffMetrics</span>(matchingJobMetricsPair: (<a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>, <a href="SparkAppReportMatcher.scala.html#L113" title="utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>)) = {<br/>
&nbsp; &nbsp; matchingJobMetricsPair._1.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="html/SparkAppHtmlUtils.scala:348">jobName</a> -&gt; <a href="#L51" title="utils/spark/SparkAppPerfAggregateDiffReport.scala:51">AggregateDiffPerfMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; <a href="SparkAppPerfAggregateReport.scala.html#L17" title="utils/spark/SparkAppPerfAggregateReport.scala:17">SparkAppPerfAggregateReport</a>.<a href="SparkAppPerfAggregateReport.scala.html#L58" title="utils/spark/SparkAppPerfAggregateReport.scala:58">accumulatedPerfMetrics</a>(matchingJobMetricsPair._1),<br/>
&nbsp; &nbsp; &nbsp; <a href="SparkAppPerfAggregateReport.scala.html#L17" title="utils/spark/SparkAppPerfAggregateReport.scala:17">SparkAppPerfAggregateReport</a>.<a href="SparkAppPerfAggregateReport.scala.html#L58" title="utils/spark/SparkAppPerfAggregateReport.scala:58">accumulatedPerfMetrics</a>(matchingJobMetricsPair._2))<br/>
&nbsp; }<br/>
}<br/>
</code>

 </body>
</html>
