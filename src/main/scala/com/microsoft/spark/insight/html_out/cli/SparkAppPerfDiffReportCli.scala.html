<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>cli/SparkAppPerfDiffReportCli.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>cli/SparkAppPerfDiffReportCli.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L13">SparkAppPerfDiffReportCli</a></li>
<li><a href="#L100">SparkAppPerfDiffReportCli</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L108">apply</a></li>
<li><a href="#L62">genDiffColumn</a></li>
</ul>
 <h2>Source code</h2>

  <code>package com.microsoft.spark.insight.cli<br/>
<br/>
import com.microsoft.spark.insight.cli.frontend._<br/>
import com.microsoft.spark.insight.html.<a href="../html/SparkAppHtmlUtils.scala.html#L22" title="html/SparkAppHtmlUtils.scala:22">SparkAppHtmlUtils</a>.<a href="../html/SparkAppHtmlUtils.scala.html#L31" title="html/SparkAppHtmlUtils.scala:31">writeAndOpenHtml</a><br/>
import com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/CommonStringUtils.scala.html#L8" title="utils/spark/CommonStringUtils.scala:8">CommonStringUtils</a>.IDENTICAL_APPS_WARNING<br/>
import com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/PerfValueConversionUtils.scala.html#L13" title="utils/spark/PerfValueConversionUtils.scala:13">PerfValueConversionUtils</a>.<a href="../utils/spark/PerfValueConversionUtils.scala.html#L61" title="utils/spark/PerfValueConversionUtils.scala:61">roundUpDouble</a><br/>
import com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L22" title="utils/spark/SparkAppPerfDiffReport.scala:22">SparkAppPerfDiffReport</a><br/>
import com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L22" title="utils/spark/SparkAppPerfDiffReport.scala:22">SparkAppPerfDiffReport</a>.<a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L91" title="utils/spark/SparkAppPerfDiffReport.scala:91">MatchingPerfValues</a><br/>
<br/>
/**<br/>
 * Generate a performance diff report comparing two Spark application runs<br/>
 */<br/>
<a id="L13">&#x200c;</a>private[cli] class <span class="linkable">SparkAppPerfDiffReportCli</span> private (withStages: Boolean)<br/>
&nbsp; &nbsp; extends <a href="PerfMetricsReport.scala.html#L149" title="cli/PerfMetricsReport.scala:149">PerfMetricsReport</a>[<a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L91" title="utils/spark/SparkAppPerfDiffReport.scala:91">MatchingPerfValues</a>](withStages)<br/>
&nbsp; &nbsp; with <a href="ReportCli.scala.html#L10" title="cli/ReportCli.scala:10">ReportCli</a>[<a href="AppIdSets.scala.html#L32" title="cli/AppIdSets.scala:32">AppIdPair</a>] {<br/>
<br/>
&nbsp; override def <a href="PerfMetricsReport.scala.html#L33" title="cli/PerfMetricsReport.scala:33">headerDefinition</a>: Array[String] = Array(&quot;Metric&quot;, &quot;App1&quot;, &quot;App2&quot;, &quot;Diff&quot;, &quot;Metric <a href="../fetcher/status/statusapiv1.scala.html#L106" title="fetcher/status/statusapiv1.scala:106">description</a>&quot;)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Generate text version of Spark performance diff report given two<br/>
&nbsp;&nbsp; * [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]], leveraging [[<a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L22" title="utils/spark/SparkAppPerfDiffReport.scala:22">SparkAppPerfDiffReport</a>]]<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param appReportPair two [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]<br/>
&nbsp;&nbsp; * @return performance report<br/>
&nbsp;&nbsp; */<br/>
&nbsp; override protected def <a href="TextReport.scala.html#L35" title="cli/TextReport.scala:35">genTextReportBody</a>[U &lt;: <a href="AppReportSets.scala.html#L11" title="cli/AppReportSets.scala:11">AppReportSets</a>[<a href="AppIdSets.scala.html#L32" title="cli/AppIdSets.scala:32">AppIdPair</a>]](appReportPair: U): String = {<br/>
&nbsp; &nbsp; val sb = new StringBuilder()<br/>
&nbsp; &nbsp; val appId1 = appReportPair.appReport1.rawSparkMetrics.<a href="../utils/spark/RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a><br/>
&nbsp; &nbsp; val appId2 = appReportPair.appReport2.rawSparkMetrics.<a href="../utils/spark/RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a><br/>
<br/>
&nbsp; &nbsp; if (appId1 == appId2) {<br/>
&nbsp; &nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(s&quot;WARNING: $IDENTICAL_APPS_WARNING\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>&quot;.<a href="frontend/package.scala.html#L36" title="cli/frontend/package.scala:36">yellow</a>.<a href="frontend/package.scala.html#L57" title="cli/frontend/package.scala:57">bold</a>)<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; val diffReport = new <a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L22" title="utils/spark/SparkAppPerfDiffReport.scala:22">SparkAppPerfDiffReport</a>(appReportPair.appReport1, appReportPair.appReport2)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(s&quot;\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>${<a href="ReportCli.scala.html#L10" title="cli/ReportCli.scala:10">ReportCli</a>.<a href="ReportCli.scala.html#L22" title="cli/ReportCli.scala:22">firstLineNote</a>}\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(s&quot;Spark Performance Comparison Report: ${appId1.<a href="frontend/package.scala.html#L36" title="cli/frontend/package.scala:36">yellow</a>} vs ${appId2.<a href="frontend/package.scala.html#L36" title="cli/frontend/package.scala:36">yellow</a>}\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(s&quot;\nAggregated metrics summary:\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; val summaryTable = <a href="PerfMetricsReport.scala.html#L65" title="cli/PerfMetricsReport.scala:65">buildMetricsTable</a>(diffReport.<a href="../utils/spark/SparkAppPerfReportBase.scala.html#L63" title="utils/spark/SparkAppPerfReportBase.scala:63">summaryReport</a>, <a href="PerfMetricsReport.scala.html#L40" title="cli/PerfMetricsReport.scala:40">tableSummaryHeader</a>)<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(summaryTable)<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(String.<a href="../heuristics/StageAnalyzer.scala.html#L39" title="heuristics/StageAnalyzer.scala:39">format</a>(&quot;~&quot; * 158) + &quot;\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(<br/>
&nbsp; &nbsp; &nbsp; <a href="PerfMetricsReport.scala.html#L101" title="cli/PerfMetricsReport.scala:101">buildPerStageTables</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &quot;Metrics for individual jobs&quot;,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; diffReport.<a href="../utils/spark/SparkAppPerfReportBase.scala.html#L70" title="utils/spark/SparkAppPerfReportBase.scala:70">jobLevelReport</a>,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &quot;Metrics for individual stages&quot;,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; diffReport.<a href="../utils/spark/SparkAppPerfReportBase.scala.html#L56" title="utils/spark/SparkAppPerfReportBase.scala:56">perJobReport</a>))<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(<a href="ReportCli.scala.html#L10" title="cli/ReportCli.scala:10">ReportCli</a>.<a href="ReportCli.scala.html#L30" title="cli/ReportCli.scala:30">htmlNote</a>)<br/>
<br/>
&nbsp; &nbsp; sb.toString<br/>
&nbsp; }<br/>
<br/>
&nbsp; override protected def <a href="PerfMetricsReport.scala.html#L26" title="cli/PerfMetricsReport.scala:26">buildPerfTableRowValues</a>(<br/>
&nbsp; &nbsp; &nbsp; <a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>: <a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L91" title="utils/spark/SparkAppPerfDiffReport.scala:91">MatchingPerfValues</a>,<br/>
&nbsp; &nbsp; &nbsp; transformer: Double =&gt; String): Array[String] =<br/>
&nbsp; &nbsp; Array(transformer(<a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>.perfValue1), transformer(<a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>.perfValue2), <a href="#L62" title="cli/SparkAppPerfDiffReportCli.scala:62">genDiffColumn</a>(<a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>, transformer))<br/>
<br/>
<a id="L62">&#x200c;</a>&nbsp; private def <span class="linkable">genDiffColumn</span>(<a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>: <a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L91" title="utils/spark/SparkAppPerfDiffReport.scala:91">MatchingPerfValues</a>, transformer: Double =&gt; String): String = {<br/>
&nbsp; &nbsp; val delta = <a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>.perfValue2 - <a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>.perfValue1<br/>
&nbsp; &nbsp; if (<a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>.perfValue1 == 0.0d || delta == 0.0d) {<br/>
&nbsp; &nbsp; &nbsp; &quot;0%&quot;<br/>
&nbsp; &nbsp; } else {<br/>
&nbsp; &nbsp; &nbsp; val percent = <a href="../utils/spark/PerfValueConversionUtils.scala.html#L61" title="utils/spark/PerfValueConversionUtils.scala:61">roundUpDouble</a>(delta * 100.0 / <a href="../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a>.perfValue1, 0)<br/>
&nbsp; &nbsp; &nbsp; s&quot;$percent% (${transformer(delta)})&quot;<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Generate Html version of Spark performance diff report given two<br/>
&nbsp;&nbsp; * [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]], leveraging [[<a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L22" title="utils/spark/SparkAppPerfDiffReport.scala:22">SparkAppPerfDiffReport</a>]]<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param appReportPair two [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]<br/>
&nbsp;&nbsp; * @return String containing path to Html File.<br/>
&nbsp;&nbsp; */<br/>
&nbsp; override protected def <a href="HtmlReport.scala.html#L35" title="cli/HtmlReport.scala:35">genHtmlReportFile</a>[U &lt;: <a href="AppReportSets.scala.html#L11" title="cli/AppReportSets.scala:11">AppReportSets</a>[<a href="AppIdSets.scala.html#L32" title="cli/AppIdSets.scala:32">AppIdPair</a>]](appReportPair: U): String = {<br/>
&nbsp; &nbsp; val sb = new StringBuilder<br/>
&nbsp; &nbsp; val appId1 = appReportPair.appReport1.rawSparkMetrics.<a href="../utils/spark/RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a><br/>
&nbsp; &nbsp; val appId2 = appReportPair.appReport2.rawSparkMetrics.<a href="../utils/spark/RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a><br/>
&nbsp; &nbsp; val diffReport = new <a href="../utils/spark/SparkAppPerfDiffReport.scala.html#L22" title="utils/spark/SparkAppPerfDiffReport.scala:22">SparkAppPerfDiffReport</a>(appReportPair.appReport1, appReportPair.appReport2)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(s&quot;\nSpark Performance Comparison Report: ${appId1.<a href="frontend/package.scala.html#L36" title="cli/frontend/package.scala:36">yellow</a>} vs ${appId2.<a href="frontend/package.scala.html#L36" title="cli/frontend/package.scala:36">yellow</a>}\<a href="../utils/AggregatePerfValue.scala.html#L28" title="utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; // <a href="../html/SparkAppHtmlUtils.scala.html#L31" title="html/SparkAppHtmlUtils.scala:31">writeAndOpenHtml</a> creates a new views.html file named '<a href="../utils/spark/RawSparkMetrics.scala.html#L31" title="utils/spark/RawSparkMetrics.scala:31">appId</a>',<br/>
&nbsp; &nbsp; // writes the rendered views.html output, opens file in browser and returns path to file<br/>
&nbsp; &nbsp; try {<br/>
&nbsp; &nbsp; &nbsp; val htmlFilePath = &quot;empty&quot;<br/>
&nbsp; &nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(s&quot;\nHTML report was written to: $htmlFilePath&quot;.<a href="frontend/package.scala.html#L39" title="cli/frontend/package.scala:39">blue</a>.<a href="frontend/package.scala.html#L57" title="cli/frontend/package.scala:57">bold</a>)<br/>
&nbsp; &nbsp; } catch {<br/>
&nbsp; &nbsp; &nbsp; case e: Exception =&gt; sb.<a href="frontend/CliTable.scala.html#L56" title="cli/frontend/CliTable.scala:56">append</a>(s&quot;\nGenerating Html report failed. Reason: $e&quot;)<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; sb.toString<br/>
&nbsp; }<br/>
}<br/>
<br/>
<a id="L100">&#x200c;</a>object <span class="linkable">SparkAppPerfDiffReportCli</span> {<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * The public API to build performance comparison report given two individual appIds<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param withStages true or false to show per-stages metrics<br/>
&nbsp;&nbsp; * @return a cli instance used to generate app performance diff report<br/>
&nbsp;&nbsp; */<br/>
<a id="L108">&#x200c;</a>&nbsp; def <span class="linkable">apply</span>(withStages: Boolean): <a href="#L13" title="cli/SparkAppPerfDiffReportCli.scala:13">SparkAppPerfDiffReportCli</a> = new <a href="#L13" title="cli/SparkAppPerfDiffReportCli.scala:13">SparkAppPerfDiffReportCli</a>(withStages)<br/>
}<br/>
</code>

 </body>
</html>
