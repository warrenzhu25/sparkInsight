<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>math/Statistics.java - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>math/Statistics.java - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L26">Statistics</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L35">Statistics</a></li>
<li><a href="#L156">average</a></li>
<li><a href="#L171">average</a></li>
<li><a href="#L246">createSample</a></li>
<li><a href="#L209">describeFactor</a></li>
<li><a href="#L48">deviates</a></li>
<li><a href="#L111">findTwoGroups</a></li>
<li><a href="#L115">findTwoGroupsRecursive</a></li>
<li><a href="#L186">median</a></li>
<li><a href="#L81">percentile</a></li>
<li><a href="#L223">readableTimespan</a></li>
<li><a href="#L268">shuffleArraySample</a></li>
<li><a href="#L142">toArray</a></li>
<li><a href="#L124">twoMeans</a></li>
</ul>
 <h2>Source code</h2>

  <code>/*<br/>
 * Copyright 2016 LinkedIn Corp.<br/>
 *<br/>
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not<br/>
 * use this file except in compliance with the License. You may obtain a copy of<br/>
 * the License at<br/>
 *<br/>
 * http://www.apache.org/licenses/LICENSE-2.0<br/>
 *<br/>
 * Unless required by applicable law or agreed to in writing, software<br/>
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT<br/>
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the<br/>
 * License for the specific language governing permissions and limitations under<br/>
 * the License.<br/>
 */<br/>
<br/>
package com.microsoft.spark.insight.math;<br/>
<br/>
import java.lang.reflect.Array;<br/>
import java.util.*;<br/>
<br/>
<br/>
/**<br/>
 * This class includes all the statistical operations<br/>
 */<br/>
<a id="L26">&#x200c;</a>public final class <span class="linkable">Statistics</span> {<br/>
<br/>
&nbsp; public static final long SECOND_IN_MS = 1000L;<br/>
&nbsp; public static final long MINUTE_IN_MS = 60L * SECOND_IN_MS;<br/>
&nbsp; public static final long HOUR_IN_MS = 60L * MINUTE_IN_MS;<br/>
<br/>
&nbsp; public static final long MINUTE = 60L;<br/>
&nbsp; public static final long HOUR = 60L * MINUTE;<br/>
<br/>
<a id="L35">&#x200c;</a>&nbsp; private <span class="linkable">Statistics</span>() {<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Check if the array has deviating elements.<br/>
&nbsp;&nbsp; * &lt;p/&gt;<br/>
&nbsp;&nbsp; * Deviating elements are found by comparing each individual value against the <a href="#L156" title="math/Statistics.java:156">average</a>.<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param values the array of values to check<br/>
&nbsp;&nbsp; * @param buffer the amount to ignore as a buffer for smaller valued lists<br/>
&nbsp;&nbsp; * @param factor the amount of allowed deviation is calculated from <a href="#L156" title="math/Statistics.java:156">average</a> * factor<br/>
&nbsp;&nbsp; * @return the index of the deviating value, or -1 if<br/>
&nbsp;&nbsp; */<br/>
<a id="L48">&#x200c;</a>&nbsp; public static int[] <span class="linkable">deviates</span>(long[] values, long buffer, double factor) {<br/>
&nbsp; &nbsp; if (values == null || values.length == 0) {<br/>
&nbsp; &nbsp; &nbsp; return new int[0];<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; long avg = <a href="#L156" title="math/Statistics.java:156">average</a>(values);<br/>
<br/>
&nbsp; &nbsp; //Find deviated elements<br/>
<br/>
&nbsp; &nbsp; long minimumDiff = Math.<a href="../heuristics/Severity.java.html#L97" title="heuristics/Severity.java:97">max</a>(buffer, (long) (avg * factor));<br/>
&nbsp; &nbsp; List&lt;Integer&gt; deviatedElements = new ArrayList&lt;Integer&gt;();<br/>
<br/>
&nbsp; &nbsp; for (int i = 0; i &lt; values.length; i++) {<br/>
&nbsp; &nbsp; &nbsp; long diff = values[i] - avg;<br/>
&nbsp; &nbsp; &nbsp; if (diff &gt; minimumDiff) {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; deviatedElements.add(i);<br/>
&nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; int[] result = new int[deviatedElements.size()];<br/>
&nbsp; &nbsp; for (int i = 0; i &lt; result.length; i++) {<br/>
&nbsp; &nbsp; &nbsp; result[i] = deviatedElements.get(i);<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; return result;<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * The <a href="#L81" title="math/Statistics.java:81">percentile</a> method returns the least value from the given list which has at least given <a href="#L81" title="math/Statistics.java:81">percentile</a>.<br/>
&nbsp;&nbsp; * @param values The list of values to find the <a href="#L81" title="math/Statistics.java:81">percentile</a> from<br/>
&nbsp;&nbsp; * @param <a href="#L81" title="math/Statistics.java:81">percentile</a> The <a href="#L81" title="math/Statistics.java:81">percentile</a><br/>
&nbsp;&nbsp; * @return The least value from the list with at least the given <a href="#L81" title="math/Statistics.java:81">percentile</a><br/>
&nbsp;&nbsp; */<br/>
<a id="L81">&#x200c;</a>&nbsp; public static long <span class="linkable">percentile</span>(List&lt;Long&gt; values, int <span class="linkable">percentile</span>) {<br/>
<br/>
&nbsp; &nbsp; if (values.size() == 0) {<br/>
&nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(&quot;Percentile of empty list is not defined.&quot;);<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; if (<a href="#L81" title="math/Statistics.java:81">percentile</a> &gt; 100 || <a href="#L81" title="math/Statistics.java:81">percentile</a> &lt; 0) {<br/>
&nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(&quot;Percentile has to be between 0-100&quot;);<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; if (<a href="#L81" title="math/Statistics.java:81">percentile</a> == 0) {<br/>
&nbsp; &nbsp; &nbsp; return 0;<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; Collections.sort(values);<br/>
<br/>
&nbsp; &nbsp; // Use Nearest Rank method.<br/>
&nbsp; &nbsp; // https://en.wikipedia.org/wiki/Percentile#The_Nearest_Rank_method<br/>
&nbsp; &nbsp; int position = (int) Math.ceil(values.size() * <a href="#L81" title="math/Statistics.java:81">percentile</a> / 100.0);<br/>
<br/>
&nbsp; &nbsp; // should never happen.<br/>
&nbsp; &nbsp; if (position == 0) {<br/>
&nbsp; &nbsp; &nbsp; return values.get(position);<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; // position is always one greater than index. Return value at the proper index<br/>
&nbsp; &nbsp; return values.get(position - 1);<br/>
&nbsp; }<br/>
<br/>
<br/>
<a id="L111">&#x200c;</a>&nbsp; public static long[][] <span class="linkable">findTwoGroups</span>(long[] values) {<br/>
&nbsp; &nbsp; return <a href="#L115" title="math/Statistics.java:115">findTwoGroupsRecursive</a>(values, <a href="#L156" title="math/Statistics.java:156">average</a>(values), 2);<br/>
&nbsp; }<br/>
<br/>
<a id="L115">&#x200c;</a>&nbsp; public static long[][] <span class="linkable">findTwoGroupsRecursive</span>(long[] values, long middle, int levels) {<br/>
&nbsp; &nbsp; if (levels &gt; 0) {<br/>
&nbsp; &nbsp; &nbsp; long[][] result = <a href="#L124" title="math/Statistics.java:124">twoMeans</a>(values, middle);<br/>
&nbsp; &nbsp; &nbsp; long newMiddle = <a href="#L156" title="math/Statistics.java:156">average</a>(result[1]) - <a href="#L156" title="math/Statistics.java:156">average</a>(result[0]);<br/>
&nbsp; &nbsp; &nbsp; return <a href="#L115" title="math/Statistics.java:115">findTwoGroupsRecursive</a>(values, newMiddle, levels - 1);<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; return <a href="#L124" title="math/Statistics.java:124">twoMeans</a>(values, middle);<br/>
&nbsp; }<br/>
<br/>
<a id="L124">&#x200c;</a>&nbsp; private static long[][] <span class="linkable">twoMeans</span>(long[] values, long middle) {<br/>
&nbsp; &nbsp; List&lt;Long&gt; smaller = new ArrayList&lt;Long&gt;();<br/>
&nbsp; &nbsp; List&lt;Long&gt; larger = new ArrayList&lt;Long&gt;();<br/>
&nbsp; &nbsp; for (int i = 0; i &lt; values.length; i++) {<br/>
&nbsp; &nbsp; &nbsp; if (values[i] &lt; middle) {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; smaller.add(values[i]);<br/>
&nbsp; &nbsp; &nbsp; } else {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; larger.add(values[i]);<br/>
&nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; long[][] result = new long[2][];<br/>
&nbsp; &nbsp; result[0] = <a href="#L142" title="math/Statistics.java:142">toArray</a>(smaller);<br/>
&nbsp; &nbsp; result[1] = <a href="#L142" title="math/Statistics.java:142">toArray</a>(larger);<br/>
<br/>
&nbsp; &nbsp; return result;<br/>
&nbsp; }<br/>
<br/>
<a id="L142">&#x200c;</a>&nbsp; private static long[] <span class="linkable">toArray</span>(List&lt;Long&gt; input) {<br/>
&nbsp; &nbsp; long[] result = new long[input.size()];<br/>
&nbsp; &nbsp; for (int i = 0; i &lt; result.length; i++) {<br/>
&nbsp; &nbsp; &nbsp; result[i] = input.get(i);<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; return result;<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Compute <a href="#L156" title="math/Statistics.java:156">average</a> for the given array of long<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param values the values<br/>
&nbsp;&nbsp; * @return The <a href="#L156" title="math/Statistics.java:156">average</a>(values)<br/>
&nbsp;&nbsp; */<br/>
<a id="L156">&#x200c;</a>&nbsp; public static long <span class="linkable">average</span>(long[] values) {<br/>
&nbsp; &nbsp; //Find <a href="#L156" title="math/Statistics.java:156">average</a><br/>
&nbsp; &nbsp; double sum = 0d;<br/>
&nbsp; &nbsp; for (long value : values) {<br/>
&nbsp; &nbsp; &nbsp; sum += value;<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; return (long) (sum / (double) values.length);<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Compute <a href="#L156" title="math/Statistics.java:156">average</a> for a List of long values<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param values the values<br/>
&nbsp;&nbsp; * @return The <a href="#L156" title="math/Statistics.java:156">average</a>(values)<br/>
&nbsp;&nbsp; */<br/>
<a id="L171">&#x200c;</a>&nbsp; public static long <span class="linkable">average</span>(List&lt;Long&gt; values) {<br/>
&nbsp; &nbsp; //Find <a href="#L156" title="math/Statistics.java:156">average</a><br/>
&nbsp; &nbsp; double sum = 0d;<br/>
&nbsp; &nbsp; for (long value : values) {<br/>
&nbsp; &nbsp; &nbsp; sum += value;<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; return (long) (sum / (double) values.size());<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Find the <a href="#L186" title="math/Statistics.java:186">median</a> of the given list<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param values The values<br/>
&nbsp;&nbsp; * @return The <a href="#L186" title="math/Statistics.java:186">median</a>(values)<br/>
&nbsp;&nbsp; */<br/>
<a id="L186">&#x200c;</a>&nbsp; public static long <span class="linkable">median</span>(List&lt;Long&gt; values) {<br/>
&nbsp; &nbsp; if (values.size() == 0) {<br/>
&nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(&quot;Median of an empty list is not defined.&quot;);<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; Collections.sort(values);<br/>
&nbsp; &nbsp; int middle = values.size() / 2;<br/>
&nbsp; &nbsp; if (values.size() % 2 == 0) {<br/>
&nbsp; &nbsp; &nbsp; return (values.get(middle - 1) + values.get(middle)) / 2;<br/>
&nbsp; &nbsp; } else {<br/>
&nbsp; &nbsp; &nbsp; return values.get(middle);<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Compute ratio and display it with a suffix.<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * Example: Average sort time&nbsp; &nbsp;&nbsp; (0.14x)<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param value The value to be compared<br/>
&nbsp;&nbsp; * @param compare The value compared against<br/>
&nbsp;&nbsp; * @param suffix The suffix string<br/>
&nbsp;&nbsp; * @return The ratio followed by suffix<br/>
&nbsp;&nbsp; */<br/>
<a id="L209">&#x200c;</a>&nbsp; public static String <span class="linkable">describeFactor</span>(long value, long compare, String suffix) {<br/>
&nbsp; &nbsp; double factor = (double) value / (double) compare;<br/>
&nbsp; &nbsp; if (Double.isNaN(factor)) {<br/>
&nbsp; &nbsp; &nbsp; return &quot;&quot;;<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; return &quot;(&quot; + String.format(&quot;%.2f&quot;, factor) + suffix + &quot;)&quot;;<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Convert milliseconds to readable value<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param milliseconds The number of milliseconds<br/>
&nbsp;&nbsp; * @return A String of readable time<br/>
&nbsp;&nbsp; */<br/>
<a id="L223">&#x200c;</a>&nbsp; public static String <span class="linkable">readableTimespan</span>(long milliseconds) {<br/>
&nbsp; &nbsp; if (milliseconds == 0) {<br/>
&nbsp; &nbsp; &nbsp; return &quot;0 sec&quot;;<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; long seconds = milliseconds / 1000;<br/>
&nbsp; &nbsp; long minutes = seconds / 60;<br/>
&nbsp; &nbsp; long hours = minutes / 60;<br/>
&nbsp; &nbsp; minutes %= 60;<br/>
&nbsp; &nbsp; seconds %= 60;<br/>
&nbsp; &nbsp; StringBuilder sb = new StringBuilder();<br/>
&nbsp; &nbsp; if (hours &gt; 0) {<br/>
&nbsp; &nbsp; &nbsp; sb.append(hours).append(&quot; hr &quot;);<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; if (minutes &gt; 0) {<br/>
&nbsp; &nbsp; &nbsp; sb.append(minutes).append(&quot; <a href="../heuristics/Severity.java.html#L125" title="heuristics/Severity.java:125">min</a> &quot;);<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; if (seconds &gt; 0) {<br/>
&nbsp; &nbsp; &nbsp; sb.append(seconds).append(&quot; sec &quot;);<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; return sb.<a href="../util/MemoryFormatUtils.java.html#L52" title="util/MemoryFormatUtils.java:52">toString</a>().trim();<br/>
&nbsp; }<br/>
<br/>
<a id="L246">&#x200c;</a>&nbsp; public static &lt;T&gt; T[] <span class="linkable">createSample</span>(Class&lt;T&gt; clazz, T[] objects, int size) {<br/>
&nbsp; &nbsp; //Skip this process if number of items already smaller than sample size<br/>
&nbsp; &nbsp; if (objects.length &lt;= size) {<br/>
&nbsp; &nbsp; &nbsp; return objects;<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; @SuppressWarnings(&quot;unchecked&quot;)<br/>
&nbsp; &nbsp; T[] result = (T[]) Array.newInstance(clazz, size);<br/>
<br/>
&nbsp; &nbsp; //Shuffle a clone copy<br/>
&nbsp; &nbsp; T[] clone = objects.clone();<br/>
&nbsp; &nbsp; Collections.shuffle(Arrays.asList(clone));<br/>
<br/>
&nbsp; &nbsp; //Take the first n items<br/>
&nbsp; &nbsp; System.arraycopy(clone, 0, result, 0, size);<br/>
<br/>
&nbsp; &nbsp; return result;<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Create a random sample within the original array<br/>
&nbsp;&nbsp; */<br/>
<a id="L268">&#x200c;</a>&nbsp; public static &lt;T&gt; void <span class="linkable">shuffleArraySample</span>(T[] array, int sampleSize) {<br/>
&nbsp; &nbsp; if (array.length &lt;= sampleSize) {<br/>
&nbsp; &nbsp; &nbsp; return;<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; T temp;<br/>
&nbsp; &nbsp; int index;<br/>
&nbsp; &nbsp; Random random = new Random();<br/>
<br/>
&nbsp; &nbsp; for (int i = 0; i &lt; sampleSize; i++) {<br/>
&nbsp; &nbsp; &nbsp; index = random.nextInt(array.length - i) + i;<br/>
&nbsp; &nbsp; &nbsp; temp = array[index];<br/>
&nbsp; &nbsp; &nbsp; array[index] = array[i];<br/>
&nbsp; &nbsp; &nbsp; array[i] = temp;<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
}<br/>
</code>

 </body>
</html>
