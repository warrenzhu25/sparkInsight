<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>utils/spark/PerfValueConversionUtils.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>utils/spark/PerfValueConversionUtils.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L13">PerfValueConversionUtils</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L43">bytesToGBs</a></li>
<li><a href="#L21">getUnitsAndTransformer</a></li>
<li><a href="#L35">millisToMinutes</a></li>
<li><a href="#L61">roundUpDouble</a></li>
<li><a href="#L51">toThousands</a></li>
</ul>
 <h2>Source code</h2>

  <code>package com.microsoft.spark.insight.utils.spark<br/>
<br/>
import java.util.concurrent.TimeUnit<br/>
<br/>
import com.microsoft.spark.insight.utils.<a href="../PerfMetric.scala.html#L17" title="utils/PerfMetric.scala:17">PerfMetric</a><br/>
import com.microsoft.spark.insight.utils.<a href="../PerfMetric.scala.html#L17" title="utils/PerfMetric.scala:17">PerfMetric</a>._<br/>
<br/>
import scala.concurrent.duration.{Duration, MILLISECONDS}<br/>
<br/>
/**<br/>
 * Utils object to <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> PerfValue into corresponding units<br/>
 */<br/>
<a id="L13">&#x200c;</a>object <span class="linkable">PerfValueConversionUtils</span> {<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * For a given <a href="../PerfMetric.scala.html#L17" title="utils/PerfMetric.scala:17">PerfMetric</a>, extract the units to <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> the perfValue into, and the corresponding transformer<br/>
&nbsp;&nbsp; * @param perfMetric a <a href="../PerfMetric.scala.html#L17" title="utils/PerfMetric.scala:17">PerfMetric</a><br/>
&nbsp;&nbsp; * @param decimalDigits precision required<br/>
&nbsp;&nbsp; * @return corresponding units and transformer<br/>
&nbsp;&nbsp; */<br/>
<a id="L21">&#x200c;</a>&nbsp; def <span class="linkable">getUnitsAndTransformer</span>(perfMetric: <a href="../PerfMetric.scala.html#L17" title="utils/PerfMetric.scala:17">PerfMetric</a>, decimalDigits: Int): (String, Double =&gt; String) = {<br/>
&nbsp; &nbsp; perfMetric match {<br/>
&nbsp; &nbsp; &nbsp; case perfMetric if MILLIS_TO_MINUTES_PERF_METRICS.contains(perfMetric) =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; (&quot;minutes&quot;, <a href="#L35" title="utils/spark/PerfValueConversionUtils.scala:35">millisToMinutes</a>(_, decimalDigits))<br/>
&nbsp; &nbsp; &nbsp; case perfMetric if BYTES_TO_GB_PERF_METRICS.contains(perfMetric) =&gt; (&quot;GB&quot;, <a href="#L43" title="utils/spark/PerfValueConversionUtils.scala:43">bytesToGBs</a>(_, decimalDigits))<br/>
&nbsp; &nbsp; &nbsp; case perfMetric if TO_THOUSANDS_PERF_METRICS.contains(perfMetric) =&gt; (&quot;thousands&quot;, <a href="#L51" title="utils/spark/PerfValueConversionUtils.scala:51">toThousands</a>(_, decimalDigits))<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> from milli seconds to minutes<br/>
&nbsp;&nbsp; * @param millis - <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> in milli seconds<br/>
&nbsp;&nbsp; * @return string representation of <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> in minutes<br/>
&nbsp;&nbsp; */<br/>
<a id="L35">&#x200c;</a>&nbsp; def <span class="linkable">millisToMinutes</span>(millis: Double, decimalDigits: Int): String =<br/>
&nbsp; &nbsp; <a href="#L61" title="utils/spark/PerfValueConversionUtils.scala:61">roundUpDouble</a>(Duration(millis, MILLISECONDS).toUnit(TimeUnit.MINUTES), decimalDigits)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> from bytes to Giga Bytes<br/>
&nbsp;&nbsp; * @param bytes - <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> in bytes<br/>
&nbsp;&nbsp; * @return string representation of <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> in Giga Bytes<br/>
&nbsp;&nbsp; */<br/>
<a id="L43">&#x200c;</a>&nbsp; def <span class="linkable">bytesToGBs</span>(bytes: Double, decimalDigits: Int): String =<br/>
&nbsp; &nbsp; <a href="#L61" title="utils/spark/PerfValueConversionUtils.scala:61">roundUpDouble</a>(bytes / scala.math.pow(2, 30), decimalDigits)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> to thousands<br/>
&nbsp;&nbsp; * @param num number to <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> to thousands<br/>
&nbsp;&nbsp; * @return string representation of <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> in thousands<br/>
&nbsp;&nbsp; */<br/>
<a id="L51">&#x200c;</a>&nbsp; def <span class="linkable">toThousands</span>(num: Double, decimalDigits: Int): String = <a href="#L61" title="utils/spark/PerfValueConversionUtils.scala:61">roundUpDouble</a>(num / 1000, decimalDigits)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * A convenience method to <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> a [[Double]] to a string, while rounding up to the nearest number with num of digit<br/>
&nbsp;&nbsp; * precision. If the absolute <a href="../../fetcher/status/statusapiv1.scala.html#L305" title="fetcher/status/statusapiv1.scala:305">value</a> is equal or larger than 100, it will not include any decimal places.<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param num double to <a href="SparkMetricsRowConversionUtils.scala.html#L40" title="utils/spark/SparkMetricsRowConversionUtils.scala:40">convert</a> to string<br/>
&nbsp;&nbsp; * @param decimalDigits number of decimal digits in string<br/>
&nbsp;&nbsp; * @return string representation of the input<br/>
&nbsp;&nbsp; */<br/>
<a id="L61">&#x200c;</a>&nbsp; def <span class="linkable">roundUpDouble</span>(num: Double, decimalDigits: Int): String = scala.math.abs(num) match {<br/>
&nbsp; &nbsp; case absNum if absNum &lt; scala.math.pow(10, -decimalDigits) * 0.5 =&gt; &quot;0&quot;<br/>
&nbsp; &nbsp; case absNum if absNum &gt;= 100 =&gt; &quot;%.0f&quot;.<a href="../../heuristics/StageAnalyzer.scala.html#L39" title="heuristics/StageAnalyzer.scala:39">format</a>(num)<br/>
&nbsp; &nbsp; case _ =&gt; s&quot;%.${decimalDigits}f&quot;.<a href="../../heuristics/StageAnalyzer.scala.html#L39" title="heuristics/StageAnalyzer.scala:39">format</a>(num)<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * List of <a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a> whose raw values are to be converted from milli seconds to minutes.<br/>
&nbsp;&nbsp; */<br/>
&nbsp; val MILLIS_TO_MINUTES_PERF_METRICS = List(<br/>
&nbsp; &nbsp; TOTAL_RUNNING_TIME,<br/>
&nbsp; &nbsp; SUBMISSION_TO_FIRST_LAUNCH_DELAY,<br/>
&nbsp; &nbsp; FIRST_LAUNCH_TO_COMPLETED,<br/>
&nbsp; &nbsp; EXECUTOR_RUNTIME_LESS_SHUFFLE,<br/>
&nbsp; &nbsp; EXECUTOR_RUNTIME,<br/>
&nbsp; &nbsp; EXECUTOR_CPU_TIME,<br/>
&nbsp; &nbsp; JVM_GC_TIME,<br/>
&nbsp; &nbsp; SHUFFLE_READ_FETCH_WAIT_TIME,<br/>
&nbsp; &nbsp; SHUFFLE_WRITE_TIME,<br/>
&nbsp; &nbsp; NET_IO_TIME)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * List of <a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a> whose raw values are to be converted from Bytes to Giga Bytes.<br/>
&nbsp;&nbsp; */<br/>
&nbsp; val BYTES_TO_GB_PERF_METRICS =<br/>
&nbsp; &nbsp; List(INPUT_SIZE, OUTPUT_SIZE, SHUFFLE_READ_SIZE, SHUFFLE_WRITE_SIZE, MEM_SPILLS, DISK_SPILLS)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * List of <a href="SparkAppPerfReport.scala.html#L145" title="utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a> whose raw values are to be converted to thousands.<br/>
&nbsp;&nbsp; */<br/>
&nbsp; val TO_THOUSANDS_PERF_METRICS = List(INPUT_RECORDS, OUTPUT_RECORDS, SHUFFLE_READ_RECORDS, SHUFFLE_WRITE_RECORDS)<br/>
}<br/>
</code>

 </body>
</html>
