<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>heuristics/ExecutorGcHeuristic.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>heuristics/ExecutorGcHeuristic.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L25">ExecutorGcHeuristic</a></li>
<li><a href="#L38">ExecutorsGcEvaluator</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L63">getTimeValues</a></li>
</ul>
 <h2>Source code</h2>

  <code>/*<br/>
 * Copyright 2016 LinkedIn Corp.<br/>
 *<br/>
 * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); you may not<br/>
 * use this file except in compliance with the License. You may obtain a copy of<br/>
 * the License at<br/>
 *<br/>
 * http://www.apache.org/licenses/LICENSE-2.0<br/>
 *<br/>
 * Unless required by applicable law or agreed to in writing, software<br/>
 * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, WITHOUT<br/>
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the<br/>
 * License for the specific language governing permissions and limitations under<br/>
 * the License.<br/>
 */<br/>
<br/>
package com.microsoft.spark.insight.heuristics<br/>
<br/>
import com.microsoft.spark.insight.fetcher.<a href="../fetcher/SparkApplicationData.scala.html#L21" title="fetcher/SparkApplicationData.scala:21">SparkApplicationData</a><br/>
import com.microsoft.spark.insight.fetcher.<a href="../fetcher/status/statusapiv1.scala.html#L111" title="fetcher/status/statusapiv1.scala:111">status</a>.<a href="../fetcher/status/statusapiv1.scala.html#L78" title="fetcher/status/statusapiv1.scala:78">ExecutorSummary</a><br/>
<br/>
/**<br/>
 * A heuristic based on GC time and CPU run time. It calculates the ratio of the total time a <a href="../utils/spark/PerJobReport.scala.html#L48" title="utils/spark/PerJobReport.scala:48">job</a> spends in GC to the total run time of a <a href="../utils/spark/PerJobReport.scala.html#L48" title="utils/spark/PerJobReport.scala:48">job</a> and warns if too much time is spent in GC.<br/>
 */<br/>
<a id="L25">&#x200c;</a>object <span class="linkable">ExecutorGcHeuristic</span> extends <a href="Heuristic.scala.html#L19" title="heuristics/Heuristic.scala:19">Heuristic</a> {<br/>
&nbsp; override val evaluators = Seq(<a href="#L38" title="heuristics/ExecutorGcHeuristic.scala:38">ExecutorsGcEvaluator</a>)<br/>
&nbsp; val SPARK_EXECUTOR_MEMORY = &quot;spark.executor.memory&quot;<br/>
&nbsp; val SPARK_EXECUTOR_CORES = &quot;spark.executor.cores&quot;<br/>
&nbsp; /** The ascending severity thresholds for the ratio of JVM GC Time and executor Run Time (checking whether ratio is above normal)<br/>
&nbsp;&nbsp; * These thresholds are experimental and are likely to change */<br/>
&nbsp; val DEFAULT_GC_SEVERITY_A_THRESHOLDS =<br/>
&nbsp; &nbsp; <a href="SeverityThresholds.scala.html#L22" title="heuristics/SeverityThresholds.scala:22">SeverityThresholds</a>(low = 0.08D, moderate = 0.1D, severe = 0.15D, critical = 0.2D, ascending = true)<br/>
&nbsp; /** The descending severity thresholds for the ratio of JVM GC Time and executor Run Time (checking whether ratio is below normal)<br/>
&nbsp;&nbsp; * These thresholds are experimental and are likely to change */<br/>
&nbsp; val DEFAULT_GC_SEVERITY_D_THRESHOLDS =<br/>
&nbsp; &nbsp; <a href="SeverityThresholds.scala.html#L22" title="heuristics/SeverityThresholds.scala:22">SeverityThresholds</a>(low = 0.05D, moderate = 0.04D, severe = 0.03D, critical = 0.01D, ascending = false)<br/>
<br/>
<a id="L38">&#x200c;</a>&nbsp; object <span class="linkable">ExecutorsGcEvaluator</span> extends <a href="SparkEvaluator.scala.html#L22" title="heuristics/SparkEvaluator.scala:22">SparkEvaluator</a> {<br/>
&nbsp; &nbsp; val headers = Seq(&quot;Key&quot;, &quot;Value&quot;)<br/>
<br/>
&nbsp; &nbsp; override def <a href="ConfigurationHeuristic.scala.html#L47" title="heuristics/ConfigurationHeuristic.scala:47">evaluate</a>(sparkAppData: <a href="../fetcher/SparkApplicationData.scala.html#L21" title="fetcher/SparkApplicationData.scala:21">SparkApplicationData</a>): Seq[<a href="HeuristicResult.scala.html#L18" title="heuristics/HeuristicResult.scala:18">AnalysisResult</a>] = {<br/>
&nbsp; &nbsp; &nbsp; lazy val executorAndDriverSummaries: Seq[<a href="../fetcher/status/statusapiv1.scala.html#L78" title="fetcher/status/statusapiv1.scala:78">ExecutorSummary</a>] = sparkAppData.executorSummaries<br/>
&nbsp; &nbsp; &nbsp; lazy val executorSummaries: Seq[<a href="../fetcher/status/statusapiv1.scala.html#L78" title="fetcher/status/statusapiv1.scala:78">ExecutorSummary</a>] = executorAndDriverSummaries.filterNot(_.<a href="../fetcher/status/statusapiv1.scala.html#L47" title="fetcher/status/statusapiv1.scala:47">id</a>.equals(&quot;driver&quot;))<br/>
&nbsp; &nbsp; &nbsp; val (jvmTime, executorRunTimeTotal) = <a href="#L63" title="heuristics/ExecutorGcHeuristic.scala:63">getTimeValues</a>(executorSummaries)<br/>
<br/>
&nbsp; &nbsp; &nbsp; val ratio: Double = jvmTime.toDouble / executorRunTimeTotal.toDouble<br/>
<br/>
&nbsp; &nbsp; &nbsp; val <a href="HeuristicResult.scala.html#L25" title="heuristics/HeuristicResult.scala:25">rows</a> = Seq(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="HeuristicResult.scala.html#L68" title="heuristics/HeuristicResult.scala:68">SimpleRowResult</a>(&quot;GC time to Executor Run time ratio&quot;, ratio.toString),<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="HeuristicResult.scala.html#L68" title="heuristics/HeuristicResult.scala:68">SimpleRowResult</a>(&quot;Total GC time&quot;, jvmTime.toString),<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="HeuristicResult.scala.html#L68" title="heuristics/HeuristicResult.scala:68">SimpleRowResult</a>(&quot;Total Executor Runtime&quot;, executorRunTimeTotal.toString)<br/>
&nbsp; &nbsp; &nbsp; )<br/>
<br/>
&nbsp; &nbsp; &nbsp; Seq(<a href="HeuristicResult.scala.html#L56" title="heuristics/HeuristicResult.scala:56">SimpleResult</a>(&quot;GC Summary&quot;, <a href="HeuristicResult.scala.html#L25" title="heuristics/HeuristicResult.scala:25">rows</a>))<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; /**<br/>
&nbsp; &nbsp;&nbsp; * returns the total JVM GC Time and total executor Run Time across all stages<br/>
&nbsp; &nbsp;&nbsp; *<br/>
&nbsp; &nbsp;&nbsp; * @param executorSummaries<br/>
&nbsp; &nbsp;&nbsp; * @return<br/>
&nbsp; &nbsp;&nbsp; */<br/>
<a id="L63">&#x200c;</a>&nbsp; &nbsp; private def <span class="linkable">getTimeValues</span>(executorSummaries: Seq[<a href="../fetcher/status/statusapiv1.scala.html#L78" title="fetcher/status/statusapiv1.scala:78">ExecutorSummary</a>]): (Long, Long) = {<br/>
&nbsp; &nbsp; &nbsp; var jvmGcTimeTotal: Long = 0<br/>
&nbsp; &nbsp; &nbsp; var executorRunTimeTotal: Long = 0<br/>
&nbsp; &nbsp; &nbsp; executorSummaries.foreach(<a href="../fetcher/status/statusapiv1.scala.html#L181" title="fetcher/status/statusapiv1.scala:181">executorSummary</a> =&gt; {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; jvmGcTimeTotal += <a href="../fetcher/status/statusapiv1.scala.html#L181" title="fetcher/status/statusapiv1.scala:181">executorSummary</a>.<a href="../fetcher/status/statusapiv1.scala.html#L94" title="fetcher/status/statusapiv1.scala:94">totalGCTime</a><br/>
&nbsp; &nbsp; &nbsp; &nbsp; executorRunTimeTotal += <a href="../fetcher/status/statusapiv1.scala.html#L181" title="fetcher/status/statusapiv1.scala:181">executorSummary</a>.<a href="../fetcher/status/statusapiv1.scala.html#L89" title="fetcher/status/statusapiv1.scala:89">totalDuration</a><br/>
&nbsp; &nbsp; &nbsp; })<br/>
&nbsp; &nbsp; &nbsp; (jvmGcTimeTotal, executorRunTimeTotal)<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
<br/>
}<br/>
<br/>
</code>

 </body>
</html>
