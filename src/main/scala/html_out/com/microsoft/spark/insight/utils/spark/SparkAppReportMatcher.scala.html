<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L184">JobAttr</a></li>
<li><a href="#L188">JobAttr</a></li>
<li><a href="#L201">JobAttrMetrics</a></li>
<li><a href="#L113">MatchingJobMetrics</a></li>
<li><a href="#L126">MatchingJobMetrics</a></li>
<li><a href="#L53">MatchingStageMetrics</a></li>
<li><a href="#L64">MatchingStageMetrics</a></li>
<li><a href="#L77">MatchingStageMetricsSeq</a></li>
<li><a href="#L91">MatchingStageMetricsSeq</a></li>
<li><a href="#L17">SparkAppReportMatcher</a></li>
<li><a href="#L31">SparkAppReportMatcher</a></li>
<li><a href="#L192">StageAttr</a></li>
<li><a href="#L197">StageAttr</a></li>
<li><a href="#L233">StageAttrMetrics</a></li>
<li><a href="#L39">StageMetrics</a></li>
<li><a href="#L41">StageMetrics</a></li>
<li><a href="#L164">UniqueAttr</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L203">JobAttrsMetrics</a></li>
<li><a href="#L135">MatchingAppReports</a></li>
<li><a href="#L235">StageAttrsMetrics</a></li>
<li><a href="#L42">apply</a></li>
<li><a href="#L65">apply</a></li>
<li><a href="#L92">apply</a></li>
<li><a href="#L127">apply</a></li>
<li><a href="#L189">apply</a></li>
<li><a href="#L198">apply</a></li>
<li><a href="#L299">matchAppReportSets</a></li>
<li><a href="#L28">matchingAppReports</a></li>
<li><a href="#L172">ordering</a></li>
<li><a href="#L276">renameDuplicates</a></li>
<li><a href="#L161">uniqueAttr</a></li>
<li><a href="#L250">verifyMatchingApps</a></li>
</ul>
 <h2>Source code</h2>

  <code>package com.microsoft.spark.insight.utils.spark<br/>
<br/>
import com.microsoft.spark.insight.utils._<br/>
import com.microsoft.spark.insight.utils.spark.<a href="RawSparkApplicationAttempt.scala.html#L14" title="com/microsoft/spark/insight/utils/spark/RawSparkApplicationAttempt.scala:14">RawSparkApplicationAttempt</a>.{JobId, StageId}<br/>
import com.microsoft.spark.insight.utils.spark.<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>.<a href="SparkAppPerfReport.scala.html#L127" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:127">StageIdAttemptId</a><br/>
import org.apache.spark.<a href="../../fetcher/status/statusapiv1.scala.html#L111" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:111">status</a>.api.v1.{<a href="../../fetcher/status/statusapiv1.scala.html#L103" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:103">JobData</a>, <a href="../../fetcher/status/statusapiv1.scala.html#L148" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:148">StageData</a>}<br/>
<br/>
import scala.collection.mutable<br/>
import scala.reflect.runtime.universe._<br/>
<br/>
/**<br/>
 * A class that represents a set of structurally matching [[<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s, accompanied by the metrics collected<br/>
 * per-<a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a>.<br/>
 *<br/>
 * @param appPerfReports to match<br/>
 */<br/>
<a id="L17">&#x200c;</a>class <span class="linkable">SparkAppReportMatcher</span>(val appPerfReports: Seq[<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]) {<br/>
&nbsp; import com.microsoft.spark.insight.utils.spark.<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>._<br/>
<br/>
&nbsp; private val _matchingAppReports: <a href="#L135" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:135">MatchingAppReports</a> = <a href="#L135" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:135">MatchingAppReports</a>(appPerfReports)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Retrieve the matching <a href="PerJobReport.scala.html#L48" title="com/microsoft/spark/insight/utils/spark/PerJobReport.scala:48">job</a> -&gt; <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> -&gt; metrics structure<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @return a sequence of [[<a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>]], which groups matching JobIds to the matching set of StageIds that<br/>
&nbsp;&nbsp; *&nbsp; &nbsp; &nbsp; &nbsp;&nbsp; belong to those jobs<br/>
&nbsp;&nbsp; */<br/>
<a id="L28">&#x200c;</a>&nbsp; def <span class="linkable">matchingAppReports</span>: <a href="#L135" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:135">MatchingAppReports</a> = _matchingAppReports<br/>
}<br/>
<br/>
<a id="L31">&#x200c;</a>object <span class="linkable">SparkAppReportMatcher</span> {<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * A pair of a [[StageId]] and its corresponding [[<a href="SparkAppPerfReport.scala.html#L145" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>]]<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param <a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a> <a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a> for this <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a><br/>
&nbsp;&nbsp; * @param perfMetrics corresponding perfMetrics<br/>
&nbsp;&nbsp; */<br/>
<a id="L39">&#x200c;</a>&nbsp; case class <span class="linkable">StageMetrics</span>(<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a>: StageId, perfMetrics: <a href="SparkAppPerfReport.scala.html#L145" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[PerfValue])<br/>
<br/>
<a id="L41">&#x200c;</a>&nbsp; object <span class="linkable">StageMetrics</span> {<br/>
<a id="L42">&#x200c;</a>&nbsp; &nbsp; private[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>] def <span class="linkable">apply</span>(stageAttrMetrics: <a href="#L233" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:233">StageAttrMetrics</a>): <a href="#L39" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:39">StageMetrics</a> =<br/>
&nbsp; &nbsp; &nbsp; <a href="#L39" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:39">StageMetrics</a>(stageAttrMetrics.stageAttr.<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a>, stageAttrMetrics.perfMetrics)<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * A collection of [[<a href="#L39" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:39">StageMetrics</a>]] from matching stages that share the same [[StageName]] and [[StageDetails]]<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param stageName <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> <a href="../../fetcher/status/statusapiv1.scala.html#L48" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:48">name</a> from [[<a href="../../fetcher/status/statusapiv1.scala.html#L148" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:148">StageData</a>]]<br/>
&nbsp;&nbsp; * @param stageDetails <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> <a href="../../fetcher/status/statusapiv1.scala.html#L176" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:176">details</a> form [[<a href="../../fetcher/status/statusapiv1.scala.html#L148" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:148">StageData</a>]]<br/>
&nbsp;&nbsp; * @param stageMetricsSeq a sequence of <a href="#L39" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:39">StageMetrics</a><br/>
&nbsp;&nbsp; */<br/>
<a id="L53">&#x200c;</a>&nbsp; case class <span class="linkable">MatchingStageMetrics</span>(<br/>
&nbsp; &nbsp; &nbsp; stageName: StageName,<br/>
&nbsp; &nbsp; &nbsp; stageDetails: StageDetails,<br/>
&nbsp; &nbsp; &nbsp; stageMetricsSeq: Seq[<a href="#L39" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:39">StageMetrics</a>]) {<br/>
&nbsp; &nbsp; private[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>] def ++(that: <a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>): <a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a> = {<br/>
&nbsp; &nbsp; &nbsp; assume(this.stageName.equals(that.stageName), &quot;Trying to merge mismatching stages&quot;)<br/>
&nbsp; &nbsp; &nbsp; assume(this.stageDetails.equals(that.stageDetails), &quot;Trying to merge mismatching stages&quot;)<br/>
&nbsp; &nbsp; &nbsp; <a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>(this.stageName, this.stageDetails, this.stageMetricsSeq ++ that.stageMetricsSeq)<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
<a id="L64">&#x200c;</a>&nbsp; object <span class="linkable">MatchingStageMetrics</span> {<br/>
<a id="L65">&#x200c;</a>&nbsp; &nbsp; private[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>] def <span class="linkable">apply</span>(stageAttrMetrics: <a href="#L233" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:233">StageAttrMetrics</a>): <a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a> =<br/>
&nbsp; &nbsp; &nbsp; <a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; stageAttrMetrics.stageAttr.stageName,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; stageAttrMetrics.stageAttr.<a href="../../fetcher/status/statusapiv1.scala.html#L176" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:176">details</a>,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Seq(<a href="#L39" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:39">StageMetrics</a>(stageAttrMetrics)))<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * A wrapper for a sequence of [[<a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>]], used for allowing a custom &quot;++&quot; operation for merging<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param matchingStageMetricsSeq sequence to wrap<br/>
&nbsp;&nbsp; */<br/>
<a id="L77">&#x200c;</a>&nbsp; class <span class="linkable">MatchingStageMetricsSeq</span>(private val matchingStageMetricsSeq: Seq[<a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>])<br/>
&nbsp; &nbsp; &nbsp; extends Seq[<a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>] {<br/>
&nbsp; &nbsp; override def length: Int = matchingStageMetricsSeq.length<br/>
<br/>
&nbsp; &nbsp; override def <a href="../../cli/AppReportSets.scala.html#L43" title="com/microsoft/spark/insight/cli/AppReportSets.scala:43">apply</a>(idx: Int): <a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a> = matchingStageMetricsSeq.<a href="../../cli/AppReportSets.scala.html#L43" title="com/microsoft/spark/insight/cli/AppReportSets.scala:43">apply</a>(idx)<br/>
<br/>
&nbsp; &nbsp; override def iterator: Iterator[<a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>] = matchingStageMetricsSeq.iterator<br/>
<br/>
&nbsp; &nbsp; private[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>] def ++(that: <a href="#L77" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:77">MatchingStageMetricsSeq</a>): <a href="#L77" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:77">MatchingStageMetricsSeq</a> =<br/>
&nbsp; &nbsp; &nbsp; new <a href="#L77" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:77">MatchingStageMetricsSeq</a>((this zip that).map {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case (stageMetricsSeq1, stageMetricsSeq2) =&gt; stageMetricsSeq1 ++ stageMetricsSeq2<br/>
&nbsp; &nbsp; &nbsp; })<br/>
&nbsp; }<br/>
<br/>
<a id="L91">&#x200c;</a>&nbsp; object <span class="linkable">MatchingStageMetricsSeq</span> {<br/>
<a id="L92">&#x200c;</a>&nbsp; &nbsp; private[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>] def <span class="linkable">apply</span>(stageAttrsMetrics: <a href="#L235" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:235">StageAttrsMetrics</a>) = {<br/>
&nbsp; &nbsp; &nbsp; // Rename duplicates<br/>
&nbsp; &nbsp; &nbsp; val renamedStages = <a href="#L276" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:276">renameDuplicates</a>(stageAttrsMetrics.map(_.stageAttr.stageName))<br/>
&nbsp; &nbsp; &nbsp; // Apply the new <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> names<br/>
&nbsp; &nbsp; &nbsp; renamedStages.zip(stageAttrsMetrics).foreach {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case (newName, stageAttrMetrics) =&gt; stageAttrMetrics.stageAttr.stageName = newName<br/>
&nbsp; &nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; &nbsp; new <a href="#L77" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:77">MatchingStageMetricsSeq</a>(stageAttrsMetrics.map(<a href="#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:53">MatchingStageMetrics</a>(_)))<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
&nbsp; type MatchingJobIds = Seq[JobId]<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * A collection of [[<a href="#L77" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:77">MatchingStageMetricsSeq</a>]] from matching jobs that share the same [[JobName]]<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param <a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a> <a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a> from [[<a href="../../fetcher/status/statusapiv1.scala.html#L103" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:103">JobData</a>]]<br/>
&nbsp;&nbsp; * @param matchingJobIds the matching JobIds represented in this collection<br/>
&nbsp;&nbsp; * @param matchingStageMetricsSeq matchingStageMetricsSeq that are ordered in the same way as the matchingJobIds<br/>
&nbsp;&nbsp; */<br/>
<a id="L113">&#x200c;</a>&nbsp; case class <span class="linkable">MatchingJobMetrics</span>(<br/>
&nbsp; &nbsp; &nbsp; <a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>: JobName,<br/>
&nbsp; &nbsp; &nbsp; matchingJobIds: MatchingJobIds,<br/>
&nbsp; &nbsp; &nbsp; matchingStageMetricsSeq: <a href="#L77" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:77">MatchingStageMetricsSeq</a>) {<br/>
&nbsp; &nbsp; private[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>] def ++(that: <a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>): <a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a> = {<br/>
&nbsp; &nbsp; &nbsp; assume(this.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>.equals(that.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>), &quot;Trying to merge mismatching jobs&quot;)<br/>
&nbsp; &nbsp; &nbsp; <a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; this.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; this.matchingJobIds ++ that.matchingJobIds,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; this.matchingStageMetricsSeq ++ that.matchingStageMetricsSeq)<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
<a id="L126">&#x200c;</a>&nbsp; object <span class="linkable">MatchingJobMetrics</span> {<br/>
<a id="L127">&#x200c;</a>&nbsp; &nbsp; private[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>] def <span class="linkable">apply</span>(jobAttrMetrics: <a href="#L201" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:201">JobAttrMetrics</a>): <a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a> =<br/>
&nbsp; &nbsp; &nbsp; <a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; jobAttrMetrics.jobAttr.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Seq(jobAttrMetrics.jobAttr.<a href="../../fetcher/status/statusapiv1.scala.html#L104" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:104">jobId</a>),<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="#L77" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:77">MatchingStageMetricsSeq</a>(jobAttrMetrics.stageAttrsMetrics))<br/>
&nbsp; }<br/>
<br/>
&nbsp; type <a href="#L135" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:135">MatchingAppReports</a> = Seq[<a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>]<br/>
<a id="L135">&#x200c;</a>&nbsp; private def <span class="linkable">MatchingAppReports</span>(appPerfReports: Seq[<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]): <span class="linkable">MatchingAppReports</span> = {<br/>
&nbsp; &nbsp; // Map the given appReports to include more attributes for Jobs and Stages that are needed for matching them<br/>
&nbsp; &nbsp; val jobAttrsMetricsPerApp = appPerfReports.map(<a href="#L203" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:203">JobAttrsMetrics</a>)<br/>
<br/>
&nbsp; &nbsp; // Verify that all of the apps match the first app, hence all of them match<br/>
&nbsp; &nbsp; jobAttrsMetricsPerApp.tail.foreach(<a href="#L250" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:250">verifyMatchingApps</a>(jobAttrsMetricsPerApp.head, _))<br/>
<br/>
&nbsp; &nbsp; // Map JobAttrs to a per-app MatchingJobsMetrics<br/>
&nbsp; &nbsp; val matchingJobMetricsPerApp: Seq[Seq[<a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>]] = jobAttrsMetricsPerApp.map(jobAttrsMetrics =&gt; {<br/>
&nbsp; &nbsp; &nbsp; // Rename duplicates<br/>
&nbsp; &nbsp; &nbsp; val renamedJobs = <a href="#L276" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:276">renameDuplicates</a>(jobAttrsMetrics.map(_.jobAttr.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>))<br/>
&nbsp; &nbsp; &nbsp; // Apply the new <a href="PerJobReport.scala.html#L48" title="com/microsoft/spark/insight/utils/spark/PerJobReport.scala:48">job</a> names<br/>
&nbsp; &nbsp; &nbsp; renamedJobs.zip(jobAttrsMetrics).foreach {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case (newName, jobAttrMetrics) =&gt; jobAttrMetrics.jobAttr.<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a> = newName<br/>
&nbsp; &nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; &nbsp; jobAttrsMetrics.map(<a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a>(_))<br/>
&nbsp; &nbsp; })<br/>
<br/>
&nbsp; &nbsp; // Reduce per-app <a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a> into a single combined set of <a href="#L113" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:113">MatchingJobMetrics</a><br/>
&nbsp; &nbsp; for (i &lt;- 0 until matchingJobMetricsPerApp.map(_.length).<a href="../AggregatePerfValue.scala.html#L24" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:24">min</a>) yield {<br/>
&nbsp; &nbsp; &nbsp; matchingJobMetricsPerApp.map(_(i)).reduce(_ ++ _)<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
&nbsp; private abstract class <a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[T] {<br/>
<a id="L161">&#x200c;</a>&nbsp; &nbsp; def <span class="linkable">uniqueAttr</span>: T<br/>
&nbsp; }<br/>
<br/>
<a id="L164">&#x200c;</a>&nbsp; private object <span class="linkable">UniqueAttr</span> {<br/>
&nbsp; &nbsp; /*<br/>
&nbsp; &nbsp;&nbsp; * A loose <a href="#L172" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:172">ordering</a> of JobDatas and StageDatas. Used for sorting and for matching jobs and stages between<br/>
&nbsp; &nbsp;&nbsp; * applications. Spark does not expose any concrete unique IDs that can be used to compare two runs. A more precise<br/>
&nbsp; &nbsp;&nbsp; * solution can be achieved by comparing DAGs, but those are not accessible by REST API, and will require manual<br/>
&nbsp; &nbsp;&nbsp; * parsing of Spark's web UI or raw logs. The below was found to be accurate enough to distinguish between different<br/>
&nbsp; &nbsp;&nbsp; * applications, but may result in a false rejection of apps<br/>
&nbsp; &nbsp;&nbsp; */<br/>
<a id="L172">&#x200c;</a>&nbsp; &nbsp; implicit def <span class="linkable">ordering</span>[A &lt;: <a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[_]: TypeTag]: Ordering[A] = typeOf[A] match {<br/>
&nbsp; &nbsp; &nbsp; case t if t &lt;:&lt; typeOf[<a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[(String, String)]] =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Ordering.by(_.asInstanceOf[<a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[(String, String)]].<a href="#L161" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:161">uniqueAttr</a>)<br/>
&nbsp; &nbsp; &nbsp; case t if t &lt;:&lt; typeOf[<a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[(String, Int)]] =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Ordering.by(_.asInstanceOf[<a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[(String, Int)]].<a href="#L161" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:161">uniqueAttr</a>)<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
&nbsp; type JobName = String<br/>
&nbsp; type StageName = String<br/>
&nbsp; type StageDetails = String<br/>
<br/>
<a id="L184">&#x200c;</a>&nbsp; private case class <span class="linkable">JobAttr</span>(<a href="../../fetcher/status/statusapiv1.scala.html#L104" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:104">jobId</a>: JobId, var <a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>: JobName, numStages: Int) extends <a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[(JobName, Int)] {<br/>
&nbsp; &nbsp; override def <a href="#L161" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:161">uniqueAttr</a>: (JobName, Int) = (<a href="../../html/SparkAppHtmlUtils.scala.html#L348" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:348">jobName</a>, numStages)<br/>
&nbsp; }<br/>
<br/>
<a id="L188">&#x200c;</a>&nbsp; private object <span class="linkable">JobAttr</span> {<br/>
<a id="L189">&#x200c;</a>&nbsp; &nbsp; def <span class="linkable">apply</span>(jobData: <a href="../../fetcher/status/statusapiv1.scala.html#L103" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:103">JobData</a>): <a href="#L184" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:184">JobAttr</a> = <a href="#L184" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:184">JobAttr</a>(jobData.<a href="../../fetcher/status/statusapiv1.scala.html#L104" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:104">jobId</a>, jobData.<a href="../../fetcher/status/statusapiv1.scala.html#L48" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:48">name</a>, jobData.<a href="../../fetcher/status/statusapiv1.scala.html#L109" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:109">stageIds</a>.size)<br/>
&nbsp; }<br/>
<br/>
<a id="L192">&#x200c;</a>&nbsp; private case class <span class="linkable">StageAttr</span>(<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a>: StageId, var stageName: StageName, <a href="../../fetcher/status/statusapiv1.scala.html#L176" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:176">details</a>: StageDetails)<br/>
&nbsp; &nbsp; &nbsp; extends <a href="#L164" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:164">UniqueAttr</a>[(StageName, StageDetails)] {<br/>
&nbsp; &nbsp; override def <a href="#L161" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:161">uniqueAttr</a>: (StageName, StageDetails) = (stageName, <a href="../../fetcher/status/statusapiv1.scala.html#L176" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:176">details</a>)<br/>
&nbsp; }<br/>
<br/>
<a id="L197">&#x200c;</a>&nbsp; private object <span class="linkable">StageAttr</span> {<br/>
<a id="L198">&#x200c;</a>&nbsp; &nbsp; def <span class="linkable">apply</span>(stageData: <a href="../../fetcher/status/statusapiv1.scala.html#L148" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:148">StageData</a>): <a href="#L192" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:192">StageAttr</a> = <a href="#L192" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:192">StageAttr</a>(stageData.<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a>, stageData.<a href="../../fetcher/status/statusapiv1.scala.html#L48" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:48">name</a>, stageData.<a href="../../fetcher/status/statusapiv1.scala.html#L176" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:176">details</a>)<br/>
&nbsp; }<br/>
<br/>
<a id="L201">&#x200c;</a>&nbsp; private case class <span class="linkable">JobAttrMetrics</span>(jobAttr: <a href="#L184" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:184">JobAttr</a>, stageAttrsMetrics: <a href="#L235" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:235">StageAttrsMetrics</a>)<br/>
&nbsp; private type <a href="#L203" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:203">JobAttrsMetrics</a> = Seq[<a href="#L201" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:201">JobAttrMetrics</a>]<br/>
<a id="L203">&#x200c;</a>&nbsp; private def <span class="linkable">JobAttrsMetrics</span>(appPerfReport: <a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>): <span class="linkable">JobAttrsMetrics</span> = {<br/>
&nbsp; &nbsp; if (appPerfReport.<a href="SparkAppPerfReport.scala.html#L39" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:39">incompleteAppRun</a>) {<br/>
&nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; s&quot;Incomplete app run detected (${appPerfReport.rawSparkMetrics.<a href="RawSparkMetrics.scala.html#L31" title="com/microsoft/spark/insight/utils/spark/RawSparkMetrics.scala:31">appId</a>}), internal matching of stages is &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s&quot;not supported. Such applications should not be used for comparing metrics as data may be incomplete.&quot;)<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; if (appPerfReport.<a href="SparkAppPerfReport.scala.html#L46" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:46">unsuccessfulJobsExist</a>) {<br/>
&nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; s&quot;App with unsuccessful jobs detected (${appPerfReport.rawSparkMetrics.<a href="RawSparkMetrics.scala.html#L31" title="com/microsoft/spark/insight/utils/spark/RawSparkMetrics.scala:31">appId</a>}), internal matching of &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s&quot;stages is not supported. Such applications should not be used for comparing metrics as data may be &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s&quot;incomplete.&quot;)<br/>
&nbsp; &nbsp; }<br/>
&nbsp; &nbsp; if (appPerfReport.<a href="SparkAppPerfReport.scala.html#L53" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:53">retriedStagesExist</a>) {<br/>
&nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; s&quot;App with multiple <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> <a href="../../fetcher/status/statusapiv1.scala.html#L49" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:49">attempts</a> detected (${appPerfReport.rawSparkMetrics.<a href="RawSparkMetrics.scala.html#L31" title="com/microsoft/spark/insight/utils/spark/RawSparkMetrics.scala:31">appId</a>}), internal &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s&quot;matching of stages is not supported. Such applications should not be used for comparing metrics as &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s&quot;they may incorrectly report duplicate task runs.&quot;)<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; appPerfReport.<a href="SparkAppPerfReportBase.scala.html#L56" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReportBase.scala:56">perJobReport</a><br/>
&nbsp; &nbsp; &nbsp; .map {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case (<a href="../../fetcher/status/statusapiv1.scala.html#L104" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:104">jobId</a>, perStageReport) =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L201" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:201">JobAttrMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L184" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:184">JobAttr</a>(appPerfReport.rawSparkMetrics.<a href="RawSparkMetrics.scala.html#L21" title="com/microsoft/spark/insight/utils/spark/RawSparkMetrics.scala:21">firstAppAttempt</a>.jobDataMap(<a href="../../fetcher/status/statusapiv1.scala.html#L104" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:104">jobId</a>)),<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L235" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:235">StageAttrsMetrics</a>(appPerfReport, perStageReport))<br/>
&nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; .toSeq<br/>
&nbsp; &nbsp; &nbsp; .sortBy(_.jobAttr)<br/>
&nbsp; }<br/>
<br/>
<a id="L233">&#x200c;</a>&nbsp; private case class <span class="linkable">StageAttrMetrics</span>(stageAttr: <a href="#L192" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:192">StageAttr</a>, perfMetrics: <a href="SparkAppPerfReport.scala.html#L145" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[PerfValue])<br/>
&nbsp; private type <a href="#L235" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:235">StageAttrsMetrics</a> = Seq[<a href="#L233" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:233">StageAttrMetrics</a>]<br/>
<a id="L235">&#x200c;</a>&nbsp; private def <span class="linkable">StageAttrsMetrics</span>(<br/>
&nbsp; &nbsp; &nbsp; appPerfReport: <a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>,<br/>
&nbsp; &nbsp; &nbsp; perStageReport: <a href="PerStageReport.scala.html#L15" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:15">PerStageReport</a>[<a href="SparkAppPerfReport.scala.html#L127" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:127">StageIdAttemptId</a>, <a href="SparkAppPerfReport.scala.html#L145" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:145">PerfMetrics</a>[PerfValue]]): <a href="#L235" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:235">StageAttrsMetrics</a> =<br/>
&nbsp; &nbsp; perStageReport<br/>
&nbsp; &nbsp; &nbsp; .map {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case (stageIdAttemptId, perfMetrics) =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L233" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:233">StageAttrMetrics</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="#L192" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:192">StageAttr</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; appPerfReport.rawSparkMetrics.<a href="RawSparkMetrics.scala.html#L21" title="com/microsoft/spark/insight/utils/spark/RawSparkMetrics.scala:21">firstAppAttempt</a>.stageDataMap(stageIdAttemptId.<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a>)(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; <a href="SparkAppPerfReport.scala.html#L127" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:127">StageIdAttemptId</a>.FIRST_STAGE_ATTEMPT_ID)),<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; perfMetrics)<br/>
&nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; &nbsp; .toSeq<br/>
&nbsp; &nbsp; &nbsp; .sortBy(_.stageAttr)<br/>
<br/>
<a id="L250">&#x200c;</a>&nbsp; private def <span class="linkable">verifyMatchingApps</span>(jobAttrsMetrics1: <a href="#L203" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:203">JobAttrsMetrics</a>, jobAttrsMetrics2: <a href="#L203" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:203">JobAttrsMetrics</a>) {<br/>
&nbsp; &nbsp; (jobAttrsMetrics1 zip jobAttrsMetrics2).foreach {<br/>
&nbsp; &nbsp; &nbsp; case (jobAttrMetrics1, jobAttrMetrics2) =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; if (!jobAttrMetrics1.jobAttr.<a href="#L161" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:161">uniqueAttr</a>.equals(jobAttrMetrics2.jobAttr.<a href="#L161" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:161">uniqueAttr</a>)) {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Apps with mismatching <a href="PerJobReport.scala.html#L48" title="com/microsoft/spark/insight/utils/spark/PerJobReport.scala:48">job</a> lists detected, unable to produce a per-<a href="PerJobReport.scala.html#L48" title="com/microsoft/spark/insight/utils/spark/PerJobReport.scala:48">job</a> matching for the apps. &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s&quot;App #1: ${jobAttrMetrics1.jobAttr.<a href="../../fetcher/status/statusapiv1.scala.html#L104" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:104">jobId</a>}; App #2: ${jobAttrMetrics2.jobAttr.<a href="../../fetcher/status/statusapiv1.scala.html#L104" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:104">jobId</a>}&quot;)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; &nbsp; &nbsp; Seq(jobAttrMetrics1.stageAttrsMetrics, jobAttrMetrics2.stageAttrsMetrics)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map(_.map(_.stageAttr.<a href="#L161" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:161">uniqueAttr</a>))<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .distinct<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .length match {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case 1 =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; case _ =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &quot;Apps with mismatching <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> lists detected, unable to &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; s&quot;produce a per-<a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> matching for the apps. Stage list for app #1: ${jobAttrMetrics1.stageAttrsMetrics<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map(_.stageAttr.<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a>)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .mkString(&quot;, &quot;)}; <a href="PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> list for app #2: ${jobAttrMetrics2.stageAttrsMetrics<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .map(_.stageAttr.<a href="../../fetcher/status/statusapiv1.scala.html#L150" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:150">stageId</a>)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; .mkString(&quot;, &quot;)}&quot;)<br/>
&nbsp; &nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; }<br/>
&nbsp; }<br/>
<br/>
<a id="L276">&#x200c;</a>&nbsp; private def <span class="linkable">renameDuplicates</span>(originalNames: Seq[String]): Seq[String] = {<br/>
&nbsp; &nbsp; val repetitionsMap = new mutable.HashMap[String, Int]()<br/>
<br/>
&nbsp; &nbsp; originalNames.map(originalName =&gt; {<br/>
&nbsp; &nbsp; &nbsp; val curRepetitions = repetitionsMap.getOrElse(originalName, 0)<br/>
&nbsp; &nbsp; &nbsp; repetitionsMap.put(originalName, curRepetitions + 1)<br/>
<br/>
&nbsp; &nbsp; &nbsp; if (curRepetitions &gt; 0) {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; originalName + s&quot; #$curRepetitions&quot;<br/>
&nbsp; &nbsp; &nbsp; } else {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; originalName<br/>
&nbsp; &nbsp; &nbsp; }<br/>
&nbsp; &nbsp; })<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Constructs a pair of [[<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>]]s from the provided pair of [[<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s sets IFF all of<br/>
&nbsp;&nbsp; * the [[<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s is each sets match<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param appPerfReports1 Spark app perf report set #1<br/>
&nbsp;&nbsp; * @param appPerfReports2 Spark app perf report set #2<br/>
&nbsp;&nbsp; * @return A pair of matchers<br/>
&nbsp;&nbsp; */<br/>
<a id="L299">&#x200c;</a>&nbsp; def <span class="linkable">matchAppReportSets</span>(<br/>
&nbsp; &nbsp; &nbsp; appPerfReports1: Seq[<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>],<br/>
&nbsp; &nbsp; &nbsp; appPerfReports2: Seq[<a href="SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]): (<a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>, <a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>) = {<br/>
&nbsp; &nbsp; try {<br/>
&nbsp; &nbsp; &nbsp; // Check if the first app report from each set match each other. A later check will verify that all of the app<br/>
&nbsp; &nbsp; &nbsp; // reports within each set match, and since matching is transitive, that will be identical to matching both of the<br/>
&nbsp; &nbsp; &nbsp; // complete sets<br/>
&nbsp; &nbsp; &nbsp; new <a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>(Seq(appPerfReports1.head, appPerfReports2.head))<br/>
&nbsp; &nbsp; } catch {<br/>
&nbsp; &nbsp; &nbsp; case iae: IllegalArgumentException =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(&quot;Mismatching sets of app reports&quot;, iae)<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; val appMatcher1 =<br/>
&nbsp; &nbsp; &nbsp; try {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; new <a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>(appPerfReports1)<br/>
&nbsp; &nbsp; &nbsp; } catch {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case iae: IllegalArgumentException =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(&quot;The first set of app reports does match internally&quot;, iae)<br/>
&nbsp; &nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; val appMatcher2 =<br/>
&nbsp; &nbsp; &nbsp; try {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; new <a href="#L17" title="com/microsoft/spark/insight/utils/spark/SparkAppReportMatcher.scala:17">SparkAppReportMatcher</a>(appPerfReports2)<br/>
&nbsp; &nbsp; &nbsp; } catch {<br/>
&nbsp; &nbsp; &nbsp; &nbsp; case iae: IllegalArgumentException =&gt;<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; throw new IllegalArgumentException(&quot;The second set of app reports does match internally&quot;, iae)<br/>
&nbsp; &nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; (appMatcher1, appMatcher2)<br/>
&nbsp; }<br/>
}<br/>
</code>

 </body>
</html>
