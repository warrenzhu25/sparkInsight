<!-- generated by the src2html.pl tool from code2ebook:
  https://github.com/agentzh/code2ebook
-->

<html>
 <head>
  <title>com/microsoft/spark/insight/cli/SparkAppPerfRegressionReportCli.scala - Spark Insight</title>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
  <style>
body {
    text-align: left;
    text-align-last: left;
}

code {
    font-family: consolas, monospace;
    line-height: 130%;
}


  </style>
 </head>
 <body>

  <h1>com/microsoft/spark/insight/cli/SparkAppPerfRegressionReportCli.scala - Spark Insight</h1>
 <h2>Data types defined</h2>
 <ul class="toc">
<li><a href="#L13">SparkAppPerfRegressionReportCli</a></li>
<li><a href="#L100">SparkAppPerfRegressionReportCli</a></li>
</ul>
 <h2>Functions defined</h2>
 <ul class="toc">
<li><a href="#L108">apply</a></li>
</ul>
 <h2>Source code</h2>

  <code>package com.microsoft.spark.insight.cli<br/>
<br/>
import com.microsoft.spark.insight.cli.frontend._<br/>
import com.microsoft.spark.insight.html.<a href="../html/SparkAppHtmlUtils.scala.html#L22" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:22">SparkAppHtmlUtils</a>.<a href="../html/SparkAppHtmlUtils.scala.html#L31" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:31">writeAndOpenHtml</a><br/>
import com.microsoft.spark.insight.utils.<a href="../utils/RegressionAnalysis.scala.html#L18" title="com/microsoft/spark/insight/utils/RegressionAnalysis.scala:18">RegressionAnalysis</a><br/>
import com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/CommonStringUtils.scala.html#L8" title="com/microsoft/spark/insight/utils/spark/CommonStringUtils.scala:8">CommonStringUtils</a>.GRIDBENCH_LINK<br/>
import com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/PerfValueConversionUtils.scala.html#L13" title="com/microsoft/spark/insight/utils/spark/PerfValueConversionUtils.scala:13">PerfValueConversionUtils</a>.<a href="../utils/spark/PerfValueConversionUtils.scala.html#L61" title="com/microsoft/spark/insight/utils/spark/PerfValueConversionUtils.scala:61">roundUpDouble</a><br/>
import com.microsoft.spark.insight.utils.spark.{<a href="../utils/spark/SparkAppPerfAggregateDiffReport.scala.html#L23" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfAggregateDiffReport.scala:23">SparkAppPerfAggregateDiffReport</a>, <a href="../utils/spark/SparkAppPerfRegressionReport.scala.html#L23" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfRegressionReport.scala:23">SparkAppPerfRegressionReport</a>}<br/>
<br/>
/**<br/>
 * Generate a performance regression report given two sets of Spark application runs<br/>
 */<br/>
<a id="L13">&#x200c;</a>private[cli] class <span class="linkable">SparkAppPerfRegressionReportCli</span> private (withStages: Boolean)<br/>
&nbsp; &nbsp; extends <a href="PerfMetricsReport.scala.html#L149" title="com/microsoft/spark/insight/cli/PerfMetricsReport.scala:149">PerfMetricsReport</a>[<a href="../utils/RegressionAnalysis.scala.html#L18" title="com/microsoft/spark/insight/utils/RegressionAnalysis.scala:18">RegressionAnalysis</a>](withStages)<br/>
&nbsp; &nbsp; with <a href="ReportCli.scala.html#L10" title="com/microsoft/spark/insight/cli/ReportCli.scala:10">ReportCli</a>[<a href="AppIdSets.scala.html#L42" title="com/microsoft/spark/insight/cli/AppIdSets.scala:42">AppIdSetPair</a>] {<br/>
<br/>
&nbsp; override def <a href="PerfMetricsReport.scala.html#L33" title="com/microsoft/spark/insight/cli/PerfMetricsReport.scala:33">headerDefinition</a>: Array[String] =<br/>
&nbsp; &nbsp; Array(&quot;Metric&quot;, &quot;Effect size&quot;, &quot;Confidence level&quot;, &quot;Regression result&quot;, &quot;Change percent&quot;, &quot;Metric <a href="../fetcher/status/statusapiv1.scala.html#L106" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:106">description</a>&quot;)<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Generate Text version of Spark performance regression report given two sets of<br/>
&nbsp;&nbsp; * [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s (e.g., &quot;before&quot; and &quot;after&quot;), leveraging<br/>
&nbsp;&nbsp; * [[<a href="../utils/spark/SparkAppPerfRegressionReport.scala.html#L23" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfRegressionReport.scala:23">SparkAppPerfRegressionReport</a>]]<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param appReportSetPair two sets of Spark [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s<br/>
&nbsp;&nbsp; * @return performance regression report<br/>
&nbsp;&nbsp; */<br/>
&nbsp; override protected def <a href="TextReport.scala.html#L35" title="com/microsoft/spark/insight/cli/TextReport.scala:35">genTextReportBody</a>[U &lt;: <a href="AppReportSets.scala.html#L11" title="com/microsoft/spark/insight/cli/AppReportSets.scala:11">AppReportSets</a>[<a href="AppIdSets.scala.html#L42" title="com/microsoft/spark/insight/cli/AppIdSets.scala:42">AppIdSetPair</a>]](appReportSetPair: U): String = {<br/>
&nbsp; &nbsp; val sb = new StringBuilder()<br/>
&nbsp; &nbsp; val regressionReport = new <a href="../utils/spark/SparkAppPerfRegressionReport.scala.html#L23" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfRegressionReport.scala:23">SparkAppPerfRegressionReport</a>(appReportSetPair.appReports1, appReportSetPair.appReports2)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(s&quot;\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>${<a href="ReportCli.scala.html#L10" title="com/microsoft/spark/insight/cli/ReportCli.scala:10">ReportCli</a>.<a href="ReportCli.scala.html#L22" title="com/microsoft/spark/insight/cli/ReportCli.scala:22">firstLineNote</a>}\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(<br/>
&nbsp; &nbsp; &nbsp; s&quot;Statistically-based performance regression report for two sets of Spark applications:\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>&quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; s&quot;${appReportSetPair.toString}\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(s&quot;\nSummarized view:\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; val summaryTable = <a href="PerfMetricsReport.scala.html#L65" title="com/microsoft/spark/insight/cli/PerfMetricsReport.scala:65">buildMetricsTable</a>(regressionReport.<a href="../utils/spark/SparkAppPerfReportBase.scala.html#L63" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReportBase.scala:63">summaryReport</a>, <a href="PerfMetricsReport.scala.html#L40" title="com/microsoft/spark/insight/cli/PerfMetricsReport.scala:40">tableSummaryHeader</a>)<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(summaryTable)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(&quot;Detailed regression metrics explanations can be found at &quot; + s&quot;$GRIDBENCH_LINK/cli&quot;.<a href="frontend/package.scala.html#L39" title="com/microsoft/spark/insight/cli/frontend/package.scala:39">blue</a>.<a href="frontend/package.scala.html#L57" title="com/microsoft/spark/insight/cli/frontend/package.scala:57">bold</a> + &quot;\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(String.<a href="../heuristics/StageAnalyzer.scala.html#L39" title="com/microsoft/spark/insight/heuristics/StageAnalyzer.scala:39">format</a>(&quot;~&quot; * 193) + &quot;\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(<br/>
&nbsp; &nbsp; &nbsp; <a href="PerfMetricsReport.scala.html#L101" title="com/microsoft/spark/insight/cli/PerfMetricsReport.scala:101">buildPerStageTables</a>(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &quot;Per-<a href="../utils/spark/PerJobReport.scala.html#L48" title="com/microsoft/spark/insight/utils/spark/PerJobReport.scala:48">job</a> regression analysis&quot;,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; regressionReport.<a href="../utils/spark/SparkAppPerfReportBase.scala.html#L70" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReportBase.scala:70">jobLevelReport</a>,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; &quot;Per-<a href="../utils/spark/PerStageReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/PerStageReport.scala:26">stage</a> regression analysis&quot;,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; regressionReport.<a href="../utils/spark/SparkAppPerfReportBase.scala.html#L56" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReportBase.scala:56">perJobReport</a>))<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(<a href="ReportCli.scala.html#L10" title="com/microsoft/spark/insight/cli/ReportCli.scala:10">ReportCli</a>.<a href="ReportCli.scala.html#L30" title="com/microsoft/spark/insight/cli/ReportCli.scala:30">htmlNote</a>)<br/>
<br/>
&nbsp; &nbsp; sb.toString<br/>
&nbsp; }<br/>
<br/>
&nbsp; override protected def <a href="PerfMetricsReport.scala.html#L26" title="com/microsoft/spark/insight/cli/PerfMetricsReport.scala:26">buildPerfTableRowValues</a>(<br/>
&nbsp; &nbsp; &nbsp; <a href="../fetcher/status/statusapiv1.scala.html#L305" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:305">value</a>: <a href="../utils/RegressionAnalysis.scala.html#L18" title="com/microsoft/spark/insight/utils/RegressionAnalysis.scala:18">RegressionAnalysis</a>,<br/>
&nbsp; &nbsp; &nbsp; transformer: Double =&gt; String): Array[String] = <a href="../fetcher/status/statusapiv1.scala.html#L305" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:305">value</a>.<a href="../utils/RegressionAnalysis.scala.html#L78" title="com/microsoft/spark/insight/utils/RegressionAnalysis.scala:78">changePercent</a> match {<br/>
&nbsp; &nbsp; case num if num.isNaN =&gt; Array(&quot;N/A&quot;, &quot;N/A&quot;, &quot;N/A&quot;, &quot;N/A&quot;)<br/>
&nbsp; &nbsp; case change: Double =&gt;<br/>
&nbsp; &nbsp; &nbsp; Array(<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="../fetcher/status/statusapiv1.scala.html#L305" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:305">value</a>.<a href="../utils/RegressionAnalysis.scala.html#L57" title="com/microsoft/spark/insight/utils/RegressionAnalysis.scala:57">effectSize</a>.toString,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="../fetcher/status/statusapiv1.scala.html#L305" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:305">value</a>.<a href="../utils/RegressionAnalysis.scala.html#L64" title="com/microsoft/spark/insight/utils/RegressionAnalysis.scala:64">confidenceLevel</a>.toString,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="../fetcher/status/statusapiv1.scala.html#L305" title="com/microsoft/spark/insight/fetcher/status/statusapiv1.scala:305">value</a>.<a href="../utils/RegressionAnalysis.scala.html#L71" title="com/microsoft/spark/insight/utils/RegressionAnalysis.scala:71">regressionResult</a>.toString,<br/>
&nbsp; &nbsp; &nbsp; &nbsp; <a href="../utils/spark/PerfValueConversionUtils.scala.html#L61" title="com/microsoft/spark/insight/utils/spark/PerfValueConversionUtils.scala:61">roundUpDouble</a>(change, 2) + &quot;%&quot;)<br/>
&nbsp; }<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * Generate Html version of Spark performance regression report given two sets of<br/>
&nbsp;&nbsp; * [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s (e.g., &quot;before&quot; and &quot;after&quot;), leveraging<br/>
&nbsp;&nbsp; * [[<a href="../utils/spark/SparkAppPerfRegressionReport.scala.html#L23" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfRegressionReport.scala:23">SparkAppPerfRegressionReport</a>]]<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param appReportSetPair a collection of [[com.microsoft.spark.insight.utils.spark.<a href="../utils/spark/SparkAppPerfReport.scala.html#L26" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfReport.scala:26">SparkAppPerfReport</a>]]s<br/>
&nbsp;&nbsp; * @return String containing path to Html File.<br/>
&nbsp;&nbsp; */<br/>
&nbsp; override protected def <a href="HtmlReport.scala.html#L35" title="com/microsoft/spark/insight/cli/HtmlReport.scala:35">genHtmlReportFile</a>[U &lt;: <a href="AppReportSets.scala.html#L11" title="com/microsoft/spark/insight/cli/AppReportSets.scala:11">AppReportSets</a>[<a href="AppIdSets.scala.html#L42" title="com/microsoft/spark/insight/cli/AppIdSets.scala:42">AppIdSetPair</a>]](appReportSetPair: U): String = {<br/>
&nbsp; &nbsp; val sb = new StringBuilder()<br/>
&nbsp; &nbsp; val regressionReport = new <a href="../utils/spark/SparkAppPerfRegressionReport.scala.html#L23" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfRegressionReport.scala:23">SparkAppPerfRegressionReport</a>(appReportSetPair.appReports1, appReportSetPair.appReports2)<br/>
<br/>
&nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(<br/>
&nbsp; &nbsp; &nbsp; s&quot;\nAggregated Performance Comparison and statistically-based performance regression report &quot; +<br/>
&nbsp; &nbsp; &nbsp; &nbsp; s&quot;for two sets of Spark applications:\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a> ${appReportSetPair.toString}\<a href="../utils/AggregatePerfValue.scala.html#L28" title="com/microsoft/spark/insight/utils/AggregatePerfValue.scala:28">n</a>&quot;)<br/>
<br/>
&nbsp; &nbsp; // <a href="../html/SparkAppHtmlUtils.scala.html#L31" title="com/microsoft/spark/insight/html/SparkAppHtmlUtils.scala:31">writeAndOpenHtml</a> creates a new views.html file named '<a href="../utils/spark/RawSparkMetrics.scala.html#L31" title="com/microsoft/spark/insight/utils/spark/RawSparkMetrics.scala:31">appId</a>',<br/>
&nbsp; &nbsp; // writes the rendered views.html output, opens file in browser and returns path to file<br/>
&nbsp; &nbsp; try {<br/>
&nbsp; &nbsp; &nbsp; val aggDiffReport =<br/>
&nbsp; &nbsp; &nbsp; &nbsp; new <a href="../utils/spark/SparkAppPerfAggregateDiffReport.scala.html#L23" title="com/microsoft/spark/insight/utils/spark/SparkAppPerfAggregateDiffReport.scala:23">SparkAppPerfAggregateDiffReport</a>(appReportSetPair.appReports1, appReportSetPair.appReports2)<br/>
&nbsp; &nbsp; &nbsp; val htmlFilePath = &quot;empty&quot;<br/>
&nbsp; &nbsp; &nbsp; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(s&quot;\nHTML report was written to: $htmlFilePath&quot;.<a href="frontend/package.scala.html#L39" title="com/microsoft/spark/insight/cli/frontend/package.scala:39">blue</a>.<a href="frontend/package.scala.html#L57" title="com/microsoft/spark/insight/cli/frontend/package.scala:57">bold</a>)<br/>
&nbsp; &nbsp; } catch {<br/>
&nbsp; &nbsp; &nbsp; case e: Exception =&gt; sb.<a href="frontend/CliTable.scala.html#L56" title="com/microsoft/spark/insight/cli/frontend/CliTable.scala:56">append</a>(s&quot;\nGenerating Html report failed. Reason: $e&quot;)<br/>
&nbsp; &nbsp; }<br/>
<br/>
&nbsp; &nbsp; sb.toString<br/>
&nbsp; }<br/>
}<br/>
<br/>
<a id="L100">&#x200c;</a>object <span class="linkable">SparkAppPerfRegressionReportCli</span> {<br/>
<br/>
&nbsp; /**<br/>
&nbsp;&nbsp; * The public API to build performance regression report given two sets of Spark applications<br/>
&nbsp;&nbsp; *<br/>
&nbsp;&nbsp; * @param withStages true or false to show per-stages metrics<br/>
&nbsp;&nbsp; * @return a cli instance used to generate app performance regression report<br/>
&nbsp;&nbsp; */<br/>
<a id="L108">&#x200c;</a>&nbsp; def <span class="linkable">apply</span>(withStages: Boolean): <a href="#L13" title="com/microsoft/spark/insight/cli/SparkAppPerfRegressionReportCli.scala:13">SparkAppPerfRegressionReportCli</a> =<br/>
&nbsp; &nbsp; new <a href="#L13" title="com/microsoft/spark/insight/cli/SparkAppPerfRegressionReportCli.scala:13">SparkAppPerfRegressionReportCli</a>(withStages)<br/>
}<br/>
</code>

 </body>
</html>
